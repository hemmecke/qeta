\documentclass{article}
\usepackage{qeta}
\externaldocument{qetasymb}


\begin{document}
\title{The QEta Package\\
\textcolor{red}{THIS IS WORK IN PROGRESS}}
\author{Ralf Hemmecke}
\maketitle
\begin{abstract}
  QEta is a software package that implements an algorithm of
  Cristian-Silviu Radu to find Ramanujan-Kolberg identities. QEta
  includes the extension of Radu's algorithm to the case of
  generalized eta-functions as given by Chen, Du, and Zhao in 2019.
  %
  Furthermore, QEta can find a basis of relations of (generalized)
  Dedekind eta-functions as well as relations among dissections of
  eta-quotients.
  %
  QEta is programmed in the computer algebra system \FriCAS{}.
\end{abstract}

\tableofcontents

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{General Overview}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

The QEta package started with an implementation of the \algo{AB}
algorithm from \cite{Radu_RamanujanKolberg_2015} and the \algoSamba{}
algorithm from \cite{Hemmecke_DancingSambaRamanujan_2018}, in addition
it implements the algorithm from
\cite{HemmeckeRadu_EtaRelations_2019} to compute all polynomial
relations of Dedekind eta-functions of a certain level.

The underlying theory of the programs is described in the articles
\cite{Radu_RamanujanKolberg_2015},
\cite{Hemmecke_DancingSambaRamanujan_2018}, and
\cite{HemmeckeRadu_EtaRelations_2019}.

Installation instructions can be found at
\url{https://hemmecke.github.io/qeta}.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Overview of the files}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

The QEta package consists of following parts that are stored in the
respective \PathName{.spad} files. We mark the files that are only
there for historical reasons by a star. They are not really necessary
to compute the relation among eta-functions.

%\include{qetaabstracts}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Theoretical background}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Notation}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{Hemmecke}
  See \cite{HemmeckePauleRadu_IntegralBasis_2021}.
\end{Hemmecke}

Let $\setH=\SetDef{\tau\in \setC}{\mathrm{Im}(\tau)>0}$ denote the
complex upper half-plane.
%
In the following $N$ denotes a positive integer. We abbreviate
\defineterm{congruence modulo $N$} by
\begin{gather}
  a \equiv_N b :\iff a \equiv b \pmod{N}
\end{gather}
%
We define the groups
\begin{align}
  \defineNotation[SL2Z]{\SL2Z}
  &=
  \SetDef{
    \begin{pmatrix}
      a & b\\
      c & d\\
    \end{pmatrix}}{a,b,c,d\in\setZ \text{ and } ad-bc=1},
  \label{eq:SL2Z}
  \\
  %
  \defineNotation[Gamma0N]{\Gamma_0(N)}
  &=
  \SetDef{
    \begin{pmatrix}
      a & b\\
      c & d\\
    \end{pmatrix} \in \SL2Z}{c \equiv_N 0};
  \label{eq:Gamma0}
  \\
  \defineNotation[Gamma1N]{\Gamma_1(N)}
  &=
  \SetDef{
    \begin{pmatrix}
      a & b\\
      c & d
    \end{pmatrix} \in \SL2Z}{c \equiv_N 0, a \equiv_N d \equiv_N 1}
  \label{eq:Gamma1}
\end{align}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{AdditionalInformation}
See, for example,
\url{https://en.wikipedia.org/wiki/Congruence_subgroup}.
\end{AdditionalInformation}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

$\SL2Z = \Gamma_0(1) = \Gamma_1(1)$ acts on $\setH$ by
$
\begin{smallpmatrix}
  a & b\\
  c & d\\
\end{smallpmatrix} \tau
=
\frac{a \tau + b}{c \tau + d}
$.
%
This action induces an action on meromorphic functions
$f:\setH\to\setChat:=\setC\cup\Set{\infty}$, namely
\begin{gather*}
  (f|\gamma)(\tau) := f(\gamma \tau).
\end{gather*}
%

Let $\Gamma$ be $\Gamma_0(N)$ or $\Gamma_1(N)$.
A \defineterm{modular function} for $\Gamma$ is a meromorphic
function $f:\setH\to\setChat$ such that
\begin{enumerate}
\item for all $\gamma \in \Gamma$:
  \begin{math}
    f|\gamma = f;
  \end{math} and
\item if
  $\gamma =
  \begin{smallpmatrix}
    a&b\\c&d
  \end{smallpmatrix}
  \in \mathrm{SL}_2(\setZ)$ then $f\left(\frac{a \tau + b}{c \tau + d}\right)$
  admits a Laurent series expansion in powers of $q^{1/w_\gamma}$ of the form
  \begin{gather}
    \label{eq:f(gamma*tau)-expansion}
    f(\gamma\tau) = \sum_{n=m}^\infty f_n q^{n/w_\gamma},
    \text{ where $q=\exp(2\pi i\tau)$, $m \in \setZ$.}
  \end{gather}
\end{enumerate}

For $\Gamma_0(N)$ the \defineterm{width} $w_\gamma$ is given by
\begin{gather}
  \defineNotation[w-gamma]{w_\gamma} = \frac{N}{\gcd(c^2, N)}
  \label{eq:width0}
\end{gather}
whereas for $\Gamma_1(N)$ it is
\begin{gather}
  w_\gamma
  =
  \begin{cases}
    1,                   & \text{if $N=4$ and $\gcd(c,4)=2$},\\
    \frac{N}{\gcd(N,c)}, & \text{otherwise},
  \end{cases}
  \label{eq:width1}
\end{gather}
see Equation~(2.49) in
\cite{ChenDuZhao_FindingModularFunctionsRamanujan_2019} or Corollary~4
(2) of \cite{ChoKooPark_ArithmeticRamanujanGoellnitzGordon_2009}.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Because of
$\gamma\infty:=\lim_{\mathrm{Im}{(\tau)}\to\infty}\gamma\tau = a/c$,
we say that \eqref{eq:f(gamma*tau)-expansion} is a
\defineterm{q-expansion-of-f-at-a/c@$q$-expansion of $f$ at $a/c$}.
Understanding $a/0=\infty$, this extends to defining $q$-expansions at
$\infty$. Note that if $\gamma'\infty=\gamma\infty=a/c$ then
$\gamma'=\gamma
\begin{smallpmatrix}
  \pm 1 & h\\0 & \pm 1
\end{smallpmatrix}
$ for some $h \in \setZ$ and, thus,
\begin{gather}
  \label{eq:f(gamma'*tau)-expansion}
  f(\gamma'\tau)
  =
  \sum_{n=m}^\infty f_n \exp(\pm 2\pi i h /w_\gamma)^n q^{n/w_\gamma};
\end{gather}
\ie, we can (uniquely) extend the definition of $f$ to points on
$\setHhat:=\setH\cup\setQ\cup\Set{\infty}$ as
\begin{gather*}
  f(a/c) =
  \begin{cases}
    f_0&\text{if $m=0$,}\\
    0&\text{if $m>0$,}\\
    \infty&\text{if $m<0$}.
  \end{cases}
\end{gather*}

Let $M^\infty(\Gamma)$ be the set of modular functions for $\Gamma$
that only have a pole (if any) at infinity.
%
An element $f\in M^\infty(\Gamma)$ has a representation as a Laurent
series in $q$.

We denote by $\defineNotation[pord]{\pord}(f)=-\ord_qf$ the
\defineterm{pole order} (at infinity) of $f$; here $\ord_qf$ is
defined as the index of the least non-zero coefficient in the
expansion~\eqref{eq:f(gamma*tau)-expansion} of $f$ in powers of $q$.
In view of~\eqref{eq:f(gamma'*tau)-expansion} with $\gamma$ being the
identity matrix and thus $w_\gamma=1$, we note that $q$-expansions at
infinity are unique in \textit{integer} powers of $q$.

The action of $\SL2Z$ on $\setH$ extends in an obvious way to an
action on $\setHhat$. The orbits of the action of the subgroup
$\Gamma\subset \SL2Z$ are denoted by
\begin{gather*} [\tau]_\Gamma :=
  \SetDef{\gamma\tau}{\gamma\in\Gamma},\qquad\tau\in\setHhat.
\end{gather*}
The set of all such orbits is denoted by
\begin{gather*}
  \defineNotation[X-0]{X_0(N)} = \SetDef{[\tau]_{\Gamma_0(N)}}{\tau\in\setHhat}
  \text{ and }
  \defineNotation[X-1]{X_1(N)} := \SetDef{[\tau]_{\Gamma_1(N)}}{\tau\in\setHhat}.
\end{gather*}
There are only finitely many cosets with respect
to $\Gamma_0(N)$; more precisely, for $N\ge2$,
\begin{gather*}
  [\SL2Z : \Gamma_0(N)]
  =
  N \prod_{\text{prime $\divides{p}{N}$}} \Bigl(1+\frac{1}{p}\Bigr).
\end{gather*}
Owing to this fact together with the observation
$\setQ\cup\{\infty\}=\SetDef{\gamma\infty}{\gamma\in\SL2Z}$,
%
there are only finitely many orbits $[\tau]_{\Gamma_0(N)}$ with
$\tau\in\setQ\cup\Set{\infty}$. These orbits are called
\defineterm{cusps} of $X_0(N)$.
Similarly, cusps of $X_1(N)$ are defined. Note that
\begin{gather*}
  [\SL2Z : \Gamma_1(N)]
  =
  N^2 \prod_{\text{prime $\divides{p}{N}$}} \Bigl(1+\frac{1}{p^2}\Bigr).
\end{gather*}

See Section 2 of \cite{DiamondShurman_ModularForms_2005} for how the
sets $X_0(N)$ and $X_1(N)$ can be given the structure of a compact
Riemann surface. The genus $g_0(N)$ of $X_0(N)$ and $g_1(N)$ of
$X_1(N)$ can be computed by a formula given in Section~6.1 and 6.2 of
\cite{Stein_ModularFormas_2007}.

From Liouville's Theorem for compact Riemann surfaces follows that a
\useterm{modular function} for $\Gamma$ that has no pole at any cusp
of $\Gamma$, is constant. This fact, is intensively used in order to
check that an element of $M^\infty(\Gamma)$ given by its $q$-expansion
at infinity is zero or not.




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Dedekind eta-function}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{Definition}\label{def:epsilon}
  Let $\defineNotation[epsilon]{\unityPowerSymbol}: \setC \to \setC$
  and $\defineNotation[epsilon-tau]{\unityPowerSymbol^\tau}: \setC \to \setC$
  be defined by
  \begin{gather*}
    \unityPower{x} := \exp(2\pi i x),
    \qquad
    \unityPowerTau{x}=\unityPower{\tau x} = \exp(2\pi i x \tau)
  \end{gather*}
\end{Definition}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Let $\defineNotation[H]{\setH}=\SetDef{c\in \setC}{\Im(c)>0}$ denote
the complex upper half-plane.

Let
\begin{gather}\label{eq:eta-expansion}
  \defineNotation[eta]{\eta}: \setH \to \setC, \quad
  \tau \mapsto \unityPowerTau{\frac{1}{24}} \prod_{n=1}^{\infty}(1-q^n)
  =
  \unityPowerTau{\frac{1}{24}} \eulerFunction{}
\end{gather}
with $\defineNotation[q]{q} = \unityPower{\tau} = \unityPowerTau{1}$
denote the \defineterm{Dedekind eta-function}.

Note that
$\defineNotation[a-q]{\qPochhammer{a}{q}}=\prod_{n=0}^{\infty}(1-aq^n)$
denotes the \defineterm{q-Pochhammer symbol@$q$-Pochhammer symbol}.
More generally, we define recursively
\begin{gather}
  \defineNotation[a-k-q]{\qPochhammer{a_1,\ldots,a_k}{q}}
  =
  \qPochhammer{a_1,\ldots,a_{k-1}}{q} \qPochhammer{a_k}{q}
\end{gather}
and abbreviate the special case $a=q$ by
\begin{gather}
  \defineNotation[q-EulerFunction]{\eulerFunction{}}
  = \qPochhammer{q}{q}.
\end{gather}


Thus, we have
\begin{gather*}
  \eta(\tau) = \unityPowerTau{\frac{1}{24}} \eulerFunction{}
\end{gather*}

For any positive integer $\delta$ we define
\begin{gather}
  \defineNotation[eta-delta]{\eta_\delta}: \setH \to \setC,\quad \tau
  \mapsto \eta(\delta\tau)
  \label{eq:eta_delta(tau)}
\end{gather}
None of these functions is identically zero.





%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Generalized Dedekind eta-function $\eta_{\delta,g}$}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Let $\defineNotation[B]{B(x)} = x^2 - x + \frac{1}{6}$
be the second Bernoulli function, $\{x\}$.
%
Denote the fractional part of $x$, by
$\defineNotation[x-fractional]{\{x\}} = x - \lfloor x \rfloor$,
$\defineNotation[x-floor]{\lfloor x \rfloor}$ denotes the greatest
integer less than or equal to $x$.
We define
\begin{gather}
    \defineNotation[P-2]{P_2(x)} = B(\{x\}) = \{x\}^2 - \{x\} + \frac{1}{6}.
    \label{eq:P-2}
\end{gather}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{Definition}
\label{def:eta_delta-g^[R](tau)}
\cite{Robins_GeneralizedDedekindEtaProducts_1994}
%
Let $0<\delta\in\setZ$ and $g\in\setZ$.
%
The \defineterm{generalized Dedekind eta-function} is given by
\begin{align}
  \defineNotation[eta-delta-g-tau-Robins]{\eta_{\delta,g}(\tau)}
  &:=
  q^{\frac{\delta}{2}P_2(\frac{g}{\delta})}
  %
  \prod_{\substack{n>0\\n\equiv g\ (\mathrm{mod}\ \delta)}} (1-q^n)
  \prod_{\substack{n>0\\n\equiv -g\ (\mathrm{mod}\ \delta)}} (1-q^n).
  \label{eq:eta_delta-g^[R](tau)-mod}
\end{align}

\begin{AdditionalInformation}
If $0<g<\delta$ then
\begin{align}
  \eta_{\delta,g}(\tau)
  &=
  q^{\frac{\delta}{2}P_2(\frac{\bar{g}}{\delta})}
  %
  \prod_{n=1}^\infty (1-q^{\delta (n-1)+\bar{g}})(1-q^{\delta n-\bar{g}})
  \notag\\
  &=
  q^{\frac{\delta}{2}P_2(\frac{\bar{g}}{\delta})}
  %
  \qPochhammer{q^{\bar{g}}}{q^\delta} \qPochhammer{q^{\delta-\bar{g}}}{q^\delta}
  =
  q^{\frac{\delta}{2}P_2(\frac{\bar{g}}{\delta})}
  %
  \theta_{\delta,g}(\tau)
  =
  q^{\frac{\delta}{2}P_2(\frac{\bar{g}}{\delta})}
  %
  \jacobiFunction{q^g}{q^\delta} \eulerFunction{\delta}^{-1}
  \label{eq:eta_delta-g^[R](tau)}
\end{align}
here $\bar{g}\in\Set{0,\ldots,\delta-1}$ is such that
$\bar{g} \equiv_\delta g$,
\end{AdditionalInformation}
\end{Definition}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{Lemma}\label{thm:eta_delta-g/2}
  \begin{gather*}
    \eta_{\delta,g+\delta}(\tau)
      =
      \eta_{\delta,-g}(\tau)
      =
      \eta_{\delta,g}(\tau).
      \label{eq:eta_delta-g^[R](tau)-mod-delta}
  \end{gather*}
\end{Lemma}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{proof}
  If $g \equiv 0 \pmod{\delta}$, the statement follows from the
  definition immediately.
  Let $g \not\equiv 0 \pmod{\delta}$.
  By the definition above we must only show that
  $P_2\left(\frac{-g}{\delta}\right) =
  P_2\left(\frac{\delta+g}{\delta}\right) =
  P_2\left(\frac{g}{\delta}\right)$ for
  $g \not\equiv 0 \pmod{\delta}$.
%
  By \eqref{eq:P-2}, we have $P_2(x+1) = P_2(x)$ for any real $x$.
  Now suppose $0\le x<1$. Then
  % \begin{gather*}
  $
    P_2(-x)
    = P_2(1-x)
    = (1-x)^2 - (1-x) + \frac{1}{6}
%      = x^2 - x  + \frac{1}{6}
    = P_2(x).
    $
    % \end{gather*}
\end{proof}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%










%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Index Sets for Generalized Eta-Quotients}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{Definition}
  \label{def:index-set}
  Let
  $0<\defineNotation{M}\in\defineNotation[N]{\setN}=\Set{0,1,\ldots}$
  be a natural number and
  $\Delta=\SetDef{\delta}{\delta\in\setN,0<\divides{\delta}{M}}$ the
  divisors of $M$.
%
  Furthermore, let $I_1 \subseteq \Delta$,
  $I_2 \subseteq \SetDef{(\delta,g)}{\delta\in\Delta,0\le g\le
    \delta}$. Then we call $\defineNotation[I]{I} = I_1 \cup I_2$ an
  \defineterm{eta index set} of level $N$ for the specification of a
  generalized eta-quotient.

  In the following, if $I$ is an \useterm{eta index set}, then define
  $\defineNotation[I-1]{I^{(1)}} := I\cap\setN$ and
  $\defineNotation[I-2]{I^{(2)}} := I \cap \setN^2$.
%
  We call $I$ a \defineterm{purified eta index set} if for any
  $(\delta,g) \in I^{(2)}$ the relation $0<g<\frac{\delta}{2}$ holds.
\end{Definition}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Let $I$ be an \useterm{eta index set}.
%
By Lemma~\ref{thm:eta_delta-g/2}, for any $(\delta, g) \in I^{(2)}$,
there exists $0 \le g' \le \lfloor\frac{\delta}{2}\rfloor$ with
$\eta_{\delta,g}=\eta_{\delta,g'}$.
Furthermore, note that
\begin{gather}
  \eta_{\delta,0}(\tau)
  = \eta(\delta\tau)^2
  \qquad\text{and}\qquad
  \eta_{\delta,\frac{\delta}{2}}(\tau)
  = \frac{\eta(\frac{\delta}{2}\tau)^2}{\eta(\delta\tau)^2}.
  \label{eq:purify-eta}
\end{gather}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Specification of (Generalized) Eta-Quotients}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{Definition}
  \label{def:eta-specification}
  A function
  \begin{gather}
    r: \setN \cup \setN^2 \to \setZ
  \end{gather}
  is called an \defineterm{eta specification} of level $M$ if
  $I := \support(r)$ is an \useterm{eta index set} of level $M$.
%
  With the notation of Definition~\ref{def:index-set} The function $r$
  specifies an eta-quotient in the following sense
  \begin{align}
    \defineNotation[g-r(tau)]{g_r(\tau)}
    &= \prod_{i\in I} \eta_i(\tau)^{r_i}
      = \prod_{\delta\in I^{(1)}} \eta(\delta\tau)^{r_\delta}
      \prod_{(\delta,g)\in I^{(2)}} \eta_{\delta,g}(\tau)^{r_{\delta,g}}.
      \label{eq:g_r(tau)}
  \end{align}

  We call $r$ a \defineterm{purified eta specification} if $I$ is a
  \defineterm{purified eta index set}.
\end{Definition}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

By Lemma~\ref{thm:eta_delta-g/2} and \eqref{eq:purify-eta} any
\useterm{eta specification} $r$ can be turned into a corresponding
\useterm{purified eta specification} $r'$ such that $g_r= g_{r'}$.
%
Thus, in order to specify a generalized eta-quotient, we can assume
(if necessary) that it is given with a \useterm{purified index set}.



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{weight and order $\rho$ at 0 and $\infty$}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Let $r$ be an \useterm{eta specification} of level $M$ with
$I=\support(r)$. We define the functions $w$, $\rho_\infty$ and
$\rho_0$ as follows:
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{align}
  \defineNotation[wgt]{\weight}(r)
  &=
    \sum_{\delta\in I^{(1)}} r_\delta
    +
    2 \cdot\sum_{(\delta,g)\in I^{(2)}, \divides{\delta}{g}} r_{\delta,g},
  \\
  \defineNotation[rhoinfty(r)]{\rho_\infty(r)}
  &=
    \frac{1}{24} \sum_{\delta\in I^{(1)}} \delta r_\delta
    +
    \frac{1}{2}
    \sum_{(\delta,g)\in I^{(2)}}\delta P_2\Bigl(\frac{g}{\delta}\Bigr)r_{\delta,g},
    \label{eq:rhoinfty}
  \\
  \defineNotation[rhozero(r)]{\rho_0(r)}
  &=
    \frac{1}{24} \sum_{\delta\in I^{(1)}} \frac{M}{\delta} r_\delta
    +
    \frac{1}{12} \sum_{(\delta,g)\in I^{(2)}} \frac{M}{\delta} r_{\delta,g}.
    \label{eq:rhozero}
\end{align}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

By \eqref{eq:eta-expansion}, \eqref{eq:eta_delta(tau)} and
\eqref{eq:eta_delta-g^[R](tau)}, $\rho_\infty(r)$ is the order of the
eta-quotient $g_r(\tau)$ in terms of $q=e^{2\pi i \tau}$.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{Lemma}\label{thm:purified-rho-computation}
  If $r$ is a \useterm{eta specification} and $r'$ its corresponding
  \useterm{purified eta specification}, then
  \begin{align*}
    \weight(r) &= \weight(r'),
    \\
    \rho_\infty(r) &= \rho_\infty(r'),
    \\
    \rho_0(r) &= \rho_0(r').
  \end{align*}
\end{Lemma}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{AdditionalInformation}
\begin{proof}
From Lemma~\ref{thm:eta_delta-g/2} and \eqref{eq:purify-eta} follows
$\weight(r) = \weight(r')$ immediately.
%
By Lemma~\ref{thm:eta_delta-g/2}, we reduce the case $(\delta,\delta)$
to $(\delta,0)$.

Let $r_{\delta,0} \neq 0$, then for the respective summands from
\eqref{eq:rhoinfty} we have
\begin{gather*}
  \frac{1}{24}\delta r_\delta
  +
  \frac{1}{2} \delta P_2\Bigl(\frac{0}{\delta}\Bigr)r_{\delta,0}
  =
  \frac{1}{24}\delta r_\delta
  +
  \frac{1}{2} \delta \frac{1}{6} r_{\delta,0}
  =
  \frac{1}{24}\delta (r_\delta + 2 r_{\delta,0})
  =
  \frac{1}{24} \delta r'_\delta.
\end{gather*}

Let $r_{\delta,\frac{\delta}{2}} \neq 0$, then for the respective
summands from \eqref{eq:rhoinfty} we have
\begin{align*}
  \frac{1}{24} \frac{\delta}{2} r_{\delta/2}
  +
  \frac{1}{24} \delta r_{\delta}
  +
  \frac{1}{2} \delta P_2\Bigl(\frac{1}{2}\Bigr) r_{\delta,\delta/2}
  &=
    \frac{1}{24} \frac{\delta}{2} r_{\delta/2}
    +
    \frac{1}{24} \delta r_{\delta}
    +
    \frac{1}{2} \delta \Bigl(-\frac{1}{12}\Bigr) r_{\delta,\delta/2}
  \\
  &=
    \frac{1}{24} \frac{\delta}{2} r_{\delta/2}
    +
    \frac{1}{24} \delta r_{\delta}
    +
    \frac{1}{24} \frac{\delta}{2} 2 r_{\delta,\delta/2}
    -
    \frac{1}{24} \delta 2 r_{\delta,\delta/2}
  \\
  &=
    \frac{1}{24} \frac{\delta}{2} (r_{\delta/2} + 2 r_{\delta,\delta/2})
    +
    \frac{1}{24} \delta (r_{\delta} - 2 r_{\delta,\delta/2})
  \\
  &=
    \frac{1}{24} \frac{\delta}{2} r'_{\delta/2}
    +
    \frac{1}{24} \delta r'_{\delta}.
\end{align*}

That proves $\rho_\infty(r) = \rho_\infty(r')$.
Similar computations show that $\rho_0(r) = \rho_0(r')$.
\end{proof}
\end{AdditionalInformation}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%





%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Problem description}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

In the following $\Gamma$ is either $\Gamma_0(N)$ or $\Gamma_1(N)$ for
the $N$ taken from the context.

Let $r$ be an \useterm{eta specification} of level $M$ with
$I=\support(r)$.
%
Furthermore, let $\defineNotation{t} < \defineNotation{m}$ be two
natural numbers.

Define the series $(a(n))_{n\in\setN}$ by
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{align}
  \defineNotation[f-tau]{f(\tau)}
  &=
    \defineNotation[sum-a-n-q-n]{{\protect\sum}_{n=0}^\infty a(n)q^n}
    :=
    \unityPowerTau{-\rho_\infty(r)} g_r(\tau)
    =
    \unityPowerTau{-\rho_\infty(r)} \prod_{i\in I} \eta_i(\tau)^{r_i}
  \notag
  \\
  &= \prod_{\delta\in I^{(1)}}
    \left(\prod_{n=1}^{\infty}(1-q^{\delta n})\right)^{r_\delta}
    \prod_{(\delta,g)\in I^{(2)}}
    \left(
    \prod_{\substack{n>0\\n\equiv g\ (\mathrm{mod}\ \delta)}} (1-q^n)
    \prod_{\substack{n>0\\n\equiv -g\ (\mathrm{mod}\ \delta)}} (1-q^n)
    \right)^{r_{\delta,g}}
  \label{eq:f(tau)}
\end{align}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Because of Lemma~\ref{thm:eta_delta-g/2} and \eqref{eq:purify-eta}, we
can always find a \useterm{purified eta specification} $r'$ that gives
rise to the same function $f(\tau)$ as $r$.

If $r$ is purified, we can write
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{gather}
  f(\tau)
  =
    \sum_{n=0}^\infty a(n)q^n
  =
  \prod_{\delta\in I^{(1)}} \eulerFunction{\delta}^{r_\delta}
  \prod_{(\delta,g)\in I^{(2)}}
    \qPochhammer{q^g, q^{\delta-g}}{q^\delta}^{r_{\delta,g}}.
\end{gather}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


Our problem consists in finding $N\in\setN$, a set
$\modularOrbit{} \subset \Set{0,\ldots,m-1}$ with
$t\in\modularOrbit{}$, an \useterm{eta specification} $s$ of level
$N$, $\Gamma$-modular functions $e_1,\ldots,e_\ell$ (with at most a
pole at infinity) and rational numbers $d_1,\ldots,d_\ell$ such that
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{gather}
  \underbrace{
    g_s(\tau)\,
    q^\beta
    \prod_{k\in\modularOrbit{}} \sum_{n=0}^\infty a(mn+k) q^n
    }_{=:\defineNotation[F-s,r,m,t-tau]{F_{s,r,m,t}(\tau)}}
  =
  \sum_{i=1}^\ell d_i e_i
  \label{eq:Ramanujan-Kolberg-Identity}
\end{gather}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
is a modular function for $\Gamma$ with a pole at most at infinity where
\begin{gather}
  \beta = \sum_{k\in\modularOrbit{}} \frac{k + \rho_\infty(r)}{m}.
  \label{eq:beta}
\end{gather}

This problem has first been solved algorithmically by Christian-Silviu
Radu in \cite{Radu_RamanujanKolberg_2015} for the case of pure
eta-quotients and the congruence subgroup $\Gamma_0(N)$.
%
An equation of the form \eqref{eq:Ramanujan-Kolberg-Identity} is
called a \defineterm{Ramanujan-Kolberg identity}.

In 2019 Radu's algorithm was also shown to be applicable to generalized
eta-quotients and the group $\Gamma_1(N)$ in
\cite{ChenDuZhao_FindingModularFunctionsRamanujan_2019} by working out
the respective modularity conditions.
%
In the generalized case we have $\modularOrbit{r,m,t}=\Set{t}$.



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{The $U_m$ operator}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Let $m$ be a positive natural number.
%
Let $\defineNotation[U-m]{U_m}$ be an operation on functions
$\phi: \setH\to\setC$ so that
\begin{gather}
  (U_m\phi)(\tau) := \frac{1}{m}\sum_{\lambda=0}^{m-1}
  \phi\left(\frac{\tau+\lambda}{m}\right).
  \label{eq:U_m}
\end{gather}

Let $r$ be an \useterm{eta specification} of level $M$ with
$I=\support(r)$.
%
Furthermore, let $t \in \setN$ with $k < m$ and with $g_r(\tau)$ as in
\ref{eq:g_r(tau)} define
\begin{gather}
  \defineNotation[f-k(tau)]{f_k(\tau)}
  :=\unityPowerTau{-t}f(\tau)
  = \unityPowerTau{-(k + \rho_\infty(r))} g_r(\tau),
  \label{eq:f_k(tau}
\end{gather}
then
\begin{align}
  (U_mf_k)(\tau)
  &=
  \frac{1}{m} \sum_{\lambda=0}^{m-1}f_k\left(\frac{\tau+\lambda}{m}\right)
  \notag
  \\
  &=
  \frac{1}{m} \sum_{\lambda=0}^{m-1}
  \unityPower{-\frac{k\tau+k\lambda}{m}}
  \sum_{n=0}^\infty a(n) \unityPower{\frac{k\tau+n\lambda}{m}}
  \notag
  \\
  &=
  \frac{1}{m}
  \sum_{n=0}^\infty
  a(n)
  \sum_{\lambda=0}^{m-1}
  \unityPower{\frac{(n-k)(\tau+\lambda)}{m}}
  \notag
  \\
  &=
  \frac{1}{m}
  \sum_{n=0}^\infty
  a(n)\,
  \unityPower{\frac{(n-k)\tau}{m}}
  \sum_{\lambda=0}^{m-1}
  \unityPower{\frac{(n-k)\lambda}{m}}
  \notag
  \\
  &=
    \sum_{n=0}^\infty
    \sum_{l=0}^{m-1} a(mn+l)\,
    \unityPower{\frac{(mn+l-k)\tau}{m}}
    \frac{1}{m}
    \sum_{\lambda=0}^{m-1}\unityPower{\frac{(mn+l-k)\lambda}{m}}
    \notag
  \\
  &=
    \sum_{n=0}^\infty a(mn+k) q^n
  \label{eq:U_m-f_k}
\end{align}
is the generating function for the series
$(a(mn+k))_{n\in\setN}$.


Note that
$\sum_{\lambda=0}^{m-1}\unityPower{\frac{(mn+l-k)\lambda}{m}}$ is
equal to $m$ for $l=k$ and vanishes in all other cases.

Using \eqref{eq:g_r(tau)}, we can also evaluate $(U_mf_k)(\tau)$ in
another way.
%
\begin{align*}
  (U_mf_k)(\tau)
  &=
  \frac{1}{m} \sum_{\lambda=0}^{m-1}f_k\left(\frac{\tau+\lambda}{m}\right)\\
  &=
    \frac{1}{m} \sum_{\lambda=0}^{m-1}
    \unityPower{-\frac{(\tau+\lambda) (k + \rho_\infty(r))}{m}}
    g_r\!\left(\frac{\tau+\lambda}{m}\right)
  \\
  &=
  \frac{1}{m}
  \unityPowerTau{-\frac{k+\rho_\infty(r)}{m}}
  \sum_{\lambda=0}^{m-1}
  \unityPower{-\frac{\lambda (k+\rho_\infty(r))}{m}}
    \prod_{i\in I} \eta_i\left(\frac{\tau+\lambda}{m}\right)^{r_i}
\end{align*}

Let $\modularOrbit{} \subseteq \Set{1,\ldots,m}$,
$\mu=\sizeOfSet{\modularOrbit{}}$ and define for
$k \in \modularOrbit{}$
\begin{align}
  \defineNotation[p-r-m-k-tau]{p_{r,m,k}(\tau)}
  &:= \unityPowerTau{\frac{k+\rho_\infty(r)}{m} } (U_mf_k)(\tau)
  = \unityPowerTau{\frac{k+\rho_\infty(r)}{m}} \sum_{n=0}^\infty a(mn+k) q^n
  \notag
  \\
  &=
    \frac{1}{m} \sum_{\lambda=0}^{m-1}
    \unityPower{-\frac{\lambda}{m} (k+\rho_\infty(r))}
    g_r\!\left(\frac{\tau+\lambda}{m}\right)
      \label{eq:p_r-m-k(tau)}
\end{align}

Furthermore, define
\begin{align}
  \defineNotation[P-r-m-t-tau]{P_{r, m, t}(\tau)}
  &:= \prod_{k \in \modularOrbit{}} p_{r,m,k}(\tau)
  = q^\beta \prod_{k \in \modularOrbit{}} \sum_{n=0}^\infty a(mn+k) q^n.
\end{align}


With this notation the left-hand side of
\eqref{eq:Ramanujan-Kolberg-Identity} turns into
\begin{align}
  \label{eq:F_s-r-m-t(tau)}
  F_{s,r,m,t}(\tau)
  &=
    g_s(\tau) \cdot P_{r,m,t}(\tau)
  =
    g_s(\tau)
    \prod_{k\in\modularOrbit{}}
    \frac{1}{m} \sum_{\lambda=0}^{m-1}
    \unityPower{-\frac{\lambda}{m} (k+\rho_\infty(r))}
    g_r\!\left(\frac{\tau+\lambda}{m}\right)
\end{align}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Modularity}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{$\Gamma_0(M)$ modularity}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{Lemma}\cite[Thm. 1.64]{Ono_WebOfModularity_2004}
  \label{thm:modular-eta-quotient-gamma0}
  Let $r$ be an \useterm{eta specification} of level $M$
  with $I := \support(r) \subset \setN$. If the conditions
  \begin{align}
    \weight(r) &= 0, \label{eq:sum=0}\\
    \rho_\infty(r) &\in \setZ, \label{eq:pure-rhoinfinity}\\
    \rho_0(r) &\in \setZ, \label{eq:pure-rho0}\\
    \sqrt{\prod_{\delta\in I}\delta^{r_\delta}}&\in\setQ\label{eq:productsquare}
  \end{align}
  are fulfilled, then $g_r(\tau)$ is a modular function for
  $\Gamma_0(M)$.
\end{Lemma}







%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{$\Gamma_1(M)$ modularity}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

According to \cite[Thm.~3]{Robins_GeneralizedDedekindEtaProducts_1994}
a generalized eta-quotient of the form
\begin{gather}
  \prod_{\substack{\divides{\delta}{M}\\ 0\le g < \delta}}
  \eta_{\delta,g}(\tau)^{a_{\delta,g}}
  \qquad
  \text{with}
  \qquad
  \defineNotation[a-delta-g]{a_{\delta,g}}\in
  \begin{cases}
    \frac{1}{2}\setZ & \text{if $g=0$ or $g=\frac{\delta}{2}$},\\
    \setZ & \text{otherwise}.
  \end{cases}
  \label{eq:generalized-eta-quotient-a}
\end{gather}
is a modular function for $\Gamma_1(M)$ if
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{gather}
  \sum_{\divides{\delta}{M}} a_{g,0} = 0\\
  \sum_{\substack{\divides{\delta}{M}\\0 \le g \le \frac{\delta}{2}}}
  \delta P_2\Bigl(\frac{g}{\delta}\Bigr) a_{\delta,g} \equiv_2 0\\
  \sum_{\substack{\divides{\delta}{M}\\0 \le g \le \frac{\delta}{2}}}
  \frac{M}{\delta} P_2(0) a_{\delta,g} \equiv_2 0.
\end{gather}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Obviously, for any generalized eta-quotient of the form
\eqref{eq:generalized-eta-quotient-a} we can always find an
\useterm{eta specification} $r$ of level $M$ giving the same function
$g_r(\tau)$ according to \eqref{eq:g_r(tau)}. Then the above
conditions translate to the following Lemma.

\begin{Lemma}
  \label{thm:modular-eta-quotient-gamma1}
  Let $r$ be an \useterm{eta specification} of level $M$ If the
  conditions
  \begin{align}
    \weight(r) &= 0,  \label{eq:generalized-weight}\\
    \rho_\infty(r) &\in \setZ, \label{eq:rhoinfinity}\\
    \rho_0(r) &\in \setZ. \label{eq:rho0}
  \end{align}
  are fulfilled, then $g_r(\tau)$ is a modular function for
  $\Gamma_1(M)$.
\end{Lemma}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{AdditionalInformation}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Order at cusps}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Order at cusps, case $\Gamma_0(M)$}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{Lemma}
  \cite[Proposition~3.2.8]{Ligozat_CourbesModulaires_1975}
  \label{thm:eta-order-0}
  Let $0<M\in\setN$ and $r$ be an \useterm{eta specification} of level
  $M$ of a $\Gamma_0(M)$-modular function $g_r(\tau)$ with
  $\support(r)\subset\setN$.
  %
  Let
  $\gamma = \begin{smallpmatrix} a & b\\ c & d\\ \end{smallpmatrix}
  \in \SL2Z$.
  %
  Then the order of the expansion of $g_r(\gamma\tau)$ in the
  uniformizing variable $q^{1/w_\gamma}$ where $w_\gamma$ is defined by
  \eqref{eq:width0} is given by
  \begin{gather}
    \frac{1}{24}\sum_{\delta\in\support(r)} \frac{M}{\gcd(M, c^2)}
                       \frac{\gcd(c,\delta)^2}{\delta} \, r_\delta,
    \label{eq:order-gamma0}
  \end{gather}
\end{Lemma}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Order at cusps, case $\Gamma_1(M)$}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Similar to the matrix by Ligozat, we can build a matrix to determine
the order of a (modular for $\Gamma_1(M)$) generalized eta-quotient
at all cusps of $\Gamma_1(M)$.
%
Let us state a result of Robins about the order of an eta-quotient at
a cusp of $\Gamma_1(M)$. See also
\cite[Lemma~2.6]{ChenDuZhao_FindingModularFunctionsRamanujan_2019}.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{Lemma}
  \label{thm:matrixEtaOrderRobins}
  \cite[Thm~4]{Robins_GeneralizedDedekindEtaProducts_1994}
  %
  Let $0<M\in\setN$ and $r$ be an \useterm{eta specification} of level
  $M$ of a $\Gamma_1(M)$-modular function $g_r(\tau)$ with
  $I = \support(r)$.
  %
  Let
  $\gamma=\left(\begin{smallmatrix}a&b\\c&d\end{smallmatrix}\right)\in\SL2Z$.
  Let
  $\lambda,\mu,\epsilon$ with $\divides{\epsilon}{M}$ and
  \begin{gather}
    \gcd(\lambda,M)=\gcd(\lambda,\mu)=\gcd(\mu,M)=1
  \end{gather}
  be such that
  $\frac{\lambda}{\mu\epsilon}$ is a cusp that is
  $\Gamma_1(M)$-equivalent to the cusp $\frac{a}{c}$ of $\Gamma_1(M)$.
  %
  Then the order of the expansion of $g_r(\gamma\tau)$ in the
  uniformizing variable $q^{\epsilon/M}$ is
  \begin{gather}
    \frac{M}{24} \sum_{\delta\in I^{(1)}}
    \frac{\gcd(\delta,\epsilon)^2}{\delta\epsilon} r_\delta +
    \frac{M}{2} \sum_{(\delta,g)\in I^{(2)}}
    \frac{\gcd(\delta,\epsilon)^2}{\delta\epsilon} P_2\Bigl(\frac{\lambda
      g}{\gcd(\delta,\epsilon)}\Bigr) r_{\delta,g}.
    \label{eq:order-gamma1}
%    \label{eq:order-rbar-non-adjusted}
  \end{gather}
\end{Lemma}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Note that $\epsilon = \gcd(c, M)$ and that if $M\ne4$ or
$\gcd(c,4)\ne2$, then according to \eqref{eq:width1},
$w_\gamma=\frac{M}{\epsilon}$.

Consider \eqref{eq:order-gamma1} at the cusps $\infty$ and
$0$ (which are $\Gamma_1(M)$-equivalent to $\frac{1}{M}$ and $1$,
respectively).
%
For the cusp $\infty$ we get $\lambda=\mu=1$ and $\epsilon=M$, \ie,
the expression \eqref{eq:order-gamma1} is equal to $\rho_\infty(r)$.

For the cusp $0$ we get $\lambda=\mu=1$ and $\epsilon=1$. \ie, the
expression \eqref{eq:order-gamma1} is equal to $\rho_0(r)$, since
$P_2(g)=P_2(0)=\frac{1}{6}$.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\end{AdditionalInformation}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%













%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Orbit}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

In this section we are looking for a set $\modularOrbit{}$ such that
$F_{s,r,m,t}(\tau)$ as defined by \eqref{eq:F_s-r-m-t(tau)} can be
made into a modular function for $\Gamma_0(N)$ or $\Gamma_1(N)$.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Orbit for $\Gamma_0(N)$}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{AdditionalInformation}
\begin{Lemma}\label{thm:y^2-1}
  Let $y\in \setZ$ be such that $gcd(y, 6)=1$ then
  $y^2 \equiv_{24} 1$, \ie, $ \frac{y^2-1}{24} \in \setZ$.
\end{Lemma}
\begin{proof}
  Let $y = 6k + l$ with $l \in \Set{0,\ldots,5}$. Then
  $\gcd(y, 6)=\gcd(l,6)=1$ only holds for $l=1$ or $l=5$.
  %
  Since $36 k^2 + 12 k l + l^2 = 12k(3k+l) + l^2$, and $12k(3k+l)$ is
  divisible by 24 for $l=1$ or $l=5$, the statement of the Lemma
  follows from the fact that $1^2\equiv_{24} 5^2 \equiv_{24} 1$.
\end{proof}
\end{AdditionalInformation}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{Definition}\cite[Def.~40]{Radu_RamanujanKolberg_2015}
  Let $n \in \setN$, $n>1$. For $x \in \setZ$ we denote by
  $[x]_n\in \setZ_n$ the residue class of $x$ modulo $n$ and define
  \begin{gather*}
    \defineNotation[S-n]{\setS_{n}}
    :=
    \SetDef{[y^2]_n}{y \in \setZ \land \gcd(y, n)=1}
    \subseteq
    \setZ_n.
  \end{gather*}
\end{Definition}

\begin{AdditionalInformation}
Let $x \in \setZ$ be such that $[x]_{24_m} \in \setS_{24m}$. Then
there exists $y \in \setZ$ with $\gcd(y, 24m)=1$ and
$[x]_{24m}=[y^2]_{24m}$, \ie, $x = y^2 + k (24m)$ for some $k\in
\setZ$. From Lemma~\ref{thm:y^2-1} follows that
$\frac{x-1}{24}=\frac{y^2-1}{24} + km \in\setZ$.
\end{AdditionalInformation}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{Definition}\cite[Def.~41]{Radu_RamanujanKolberg_2015}
  Let $r$ be an \useterm{eta specification} of level $M$ with
  $\support(r) \subset \setN$ and let $t<m$ be two natural numbers.
  %
  The mapping
  \begin{align*}
    \defineNotation[odotbar-r]{\bar{\odot}_r}
    &: \setS_{24m} \times \Set{0,\ldots,m-1} \to \Set{0,\ldots,m-1},
    \qquad
    ([x]_{24m}, t) \mapsto [x]_{24m}  \mathbin{\bar{\odot}_r} t
  \end{align*}
  is uniquely given by
  \begin{gather}
    [x]_{24m} \mathbin{\bar{\odot}_r} t
    :=
    \left( t x + (x-1) \rho_\infty(r) \right) \bmod{m}
  \end{gather}
\end{Definition}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{Definition}
  \label{def:modularOrbit}
  (Definition 42 and Lemma 43 of \cite{Radu_RamanujanKolberg_2015})
  Let $r$ be an \useterm{eta specification} of level $M$ with
  $\support(r) \subset \setN$ and let $t<m$ be two natural numbers.
%
  We define
  %
  \begin{align}
    \defineNotation[O-r-m-t]{\modularOrbit{r,m,t}}
    &:=
      \setS_{24m}  \mathbin{\bar{\odot}_r} t
      =
      \SetDef{x \mathbin{\bar{\odot}_r} t}{x \in \setS_{24m}}.
  \end{align}
\end{Definition}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{Lemma}
  \label{thm:orbit-sum}
  \cite[Lemma~43]{Radu_RamanujanKolberg_2015}
  Let $r,m,t$ as in Definition~\ref{def:modularOrbit}, then
  \begin{gather}
  \forall x \in \setS_{24m}:
  \modularOrbit{r,m,t}
    = x \mathbin{\bar{\odot}_r} \modularOrbit{r,m,t}
    := \SetDef{x \mathbin{\bar{\odot}_r} k}{k\in \modularOrbit{r,m,t}},
    \\
    \frac{24}{m}\sum_{k \in \modularOrbit{r,m,t}} (k + \rho_\infty(r)) \in \setZ.
    \label{eq:orbit-rum}
  \end{gather}
\end{Lemma}

If we choose $\modularOrbit{} = \modularOrbit{r,m,t}$, we can find a
natural number $N$ and an \useterm{eta specification} $s$ such that
$F_{s,r,m,t}(\tau)$ ad define in \eqref{eq:F_s-r-m-t(tau)} is a
modular function for $\Gamma_0(N)$.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Orbit for $\Gamma_1(N)$}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

If we choose $\modularOrbit{} = \Set{t}$, we can find a natural number
$N$ and an \useterm{eta specification} $s$ such that
$F_{s,r,m,t}(\tau)$ ad define in \eqref{eq:F_s-r-m-t(tau)} is a
modular function for $\Gamma_1(N)$.



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Conditions for $N$}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

In this section, we list sufficient conditions for $N$ such that
$F_{s,r,m,t}(\tau)$ as defined by \eqref{eq:F_s-r-m-t(tau)} can be
made into a modular function for $\Gamma_0(N)$ or $\Gamma_1(N)$.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Conditions for $N$, case $\Gamma_0(N)$}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{Definition}\cite[Def.~35]{Radu_RamanujanKolberg_2015}
  \label{def:condition-co-eta-quotient-gamma0}
  Let
  $\defineNotation[M]{M}, \defineNotation[N]{N},
  \defineNotation[m]{m}, \defineNotation{t} \in \setN$ with $M,N>0$,
  $t<m$.
  %
  Let $r$ be an \useterm{eta specification} of level $M$
  with $I := \support(r) \subset \setN$.
  %
  Furthermore let $\defineNotation[kappa]{\kappa} :=\gcd(1-m^2,
  24)\ge1$
  %
  and $e, u\in\setZ$ be such that $u$ is odd and
  $\divisorprod{M} \delta^{\abs{r_\delta}}=2^e u$.


  We define the following conditions
  \begin{gather}
    \forall \delta \in I^{(1)}:
    \divides{\delta}{M} \land r_\delta\ne0 \implies \divides{\delta}{mN},
    \tag{N1}
    \label{eq:delta|M=>delta|mN}
    \\
    \forall p:
    p\text{ prime } \land \divides{p}{m} \implies \divides{p}{N},
    \tag{N2}
    \label{eq:p|m=>p|N}
    \\
    \frac{\kappa N}{8} \weight(r) \in \setZ,
    \tag{N3}
    \label{eq:sum-r}
    \\
    \frac{\kappa m N^2}{M} \rho_0(r) \in \setZ,
    \tag{N4}
    \label{eq:rv24}
    \\
    \frac{N \gcd(24 \kappa(t + \rho_\infty(r)),24m)}{24m} \in \setZ,
    \tag{N5}
    \label{eq:w|N}
    \\
    \divides{2}{m} \implies (\divides{4}{\kappa N} \land \divides{8}{N e})
    \lor
    (\divides{2}{e} \land \divides{8}{N(u-1)}).
    \tag{N6}
    \label{eq:even-m}
  \end{gather}
\end{Definition}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

For the first two conditions \eqref{eq:delta|M=>delta|mN} and
\eqref{eq:p|m=>p|N} see Definition~34 in
\cite{Radu_RamanujanKolberg_2015}.

\begin{AdditionalInformation}
  See also conditions (13) and 14 in
  \cite{Radu_AlgorithmicApproachRamanujanCongruences_2009} or
  Section~4.2 in \cite{Radu_PhD_2010}.
\end{AdditionalInformation}

Actually, the condition $\divides{\delta}{M}$ is superfluous, because
it is implicitly given through the fact that $r$ is an \useterm{eta
  specification} of level $M$.



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Conditions for $N$, case $\Gamma_1(N)$}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

We follow here Section~10 of
\cite{ChenDuZhao_FindingModularFunctionsRamanujan_2019}.
%
Most formulas are merely reformulations of the respective formulas in
\cite{ChenDuZhao_FindingModularFunctionsRamanujan_2019}.
%
Below, we use the notation CDZ($n$) to refer to condition $n$ in
Section~10 of \cite{ChenDuZhao_FindingModularFunctionsRamanujan_2019}.

\begin{Definition}
  \cite[Sect.~10]{ChenDuZhao_FindingModularFunctionsRamanujan_2019}
  \label{def:condition-co-eta-quotient-gamma1}

  Let $M, N, m, t \in \setN$ with $M,N>0$, $t<m$.
  %
  Let $r$ be a \useterm{purified eta specification} of
  level $M$ with $I := \support(r)$.
  %
  Furthermore let $\kappa :=\gcd(1-m^2, 24)\ge1$,
  %
  $e, u\in\setZ$ be such that $u$ is odd and
  $\divisorprod{M} \delta^{\abs{r_\delta}}=2^e u$ and let
  %
  \begin{gather*}
    \defineNotation[Sbar-n]{\bar{\setS}_{n}}
    :=
    \SetDef{[y^2]_n}{y \in \setZ \land \gcd(y, n)=1, y\equiv_N 1}
    \subseteq
    \setZ_n.
  \end{gather*}

  We defne the following conditions
  \begingroup
  \def\CDZ#1{CDZ(#1)}
  \begin{gather}
    \divides{M}{N},
      %
    \qquad
    \text{see \CDZ{1}}
    \\
    \forall p:
    p\text{ prime } \land \divides{p}{m} \implies \divides{p}{N},
    \qquad
    \text{= \eqref{eq:p|m=>p|N}, \CDZ{2}}
    \label{eq:conditionPrimeDivisors?(nn,m)}
    \\
    \frac{\kappa N}{8}  \weight(r) \in \setZ,
    \qquad
    \text{= \eqref{eq:sum-r}, \CDZ{6}}
    \label{eq:conditionSumExponentsPure?(nn,rspec,m)}
    \\
    \frac{\kappa N}{4} \sum_{(\delta,g) \in I^{(2)}} r_{\delta,g} \in \setZ,
    \qquad
    \text{see \CDZ{4}}
    \label{eq:conditionSumExponentsProperGeneralized?(nn,rspec,m)}
    \\
    \frac{\kappa N}{2} \sum_{(\delta,g) \in I^{(2)}} \frac{g}{\delta}
    r_{\delta,g}
    \in \setZ,
    \qquad
    \text{see \CDZ{3}}
    \label{eq:conditionGSigma0?(nn,rspec,m)}
    \\
%    \kappa m N \divisorsum{M} \frac{N}{\delta} r_{\delta,0} \equiv_{24} 0,
    \frac{\kappa m \, N^2}{24} \sum_{\delta\in I^{(I)}}
    \frac{r_\delta}{\delta}  \in \setZ,
    \qquad
    \text{see \eqref{eq:rv24}, \CDZ{7}}
    \label{eq:conditionSigma0Pure?(nn,mm,r,m)}
    \\
%    \kappa m N \gensum[M] \frac{N}{\delta} r_{\delta,g} \equiv_{12} 0,
    \frac{\kappa m \, N^2}{12} \sum_{(\delta,g)\in I^{(2)}}
    \frac{r_{\delta,g}}{\delta} \in \setZ,
    \qquad
    \text{see \CDZ{5}}
    \label{eq:conditionSigma0ProperGeneralized?(nn,rspec,m)}
    \\
    \frac{N \gcd(24 \kappa M (t + \rho_\infty(r)), 24 m M)}{24 m M} \in \setZ,
    \qquad
    \text{see \eqref{eq:w|N}, \CDZ{8}}
    \label{eq:conditionNDivosor?(nn,rspec,m,t)}
    \\
    \divides{2}{m} \implies (\divides{4}{\kappa N} \land \divides{8}{N e})
    \lor
    (\divides{2}{e} \land \divides{8}{N(u-1)}),
    \qquad
    \text{= \eqref{eq:even-m}, \CDZ{9}}
    \label{eq:conditionEvenMultiplier?(nn,rspec,m)}
    \\
    \forall x\in\bar{\setS}_{24mM}: (x-1) (t + \rho_\infty(r))
    \equiv_m 0,
    \qquad
    \text{see \CDZ{10}}.
    \label{eq:conditionOrbitLength?(nn,mm,r,rtilde,m,t)}
  \end{gather}
  \endgroup
\end{Definition}






Note that the conditions from Definitions
\ref{def:condition-co-eta-quotient-gamma0} and
\ref{def:condition-co-eta-quotient-gamma1} are clearly fulfilled for
$N=24mN$.




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Cofactor conditions}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

In this section we are looking for an \useterm{eta specification} $s$
such that $F_{s,r,m,t}(\tau)$ as defined by \eqref{eq:F_s-r-m-t(tau)} can be
made into a modular function for $\Gamma_0(N)$ or $\Gamma_1(N)$.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Cofactor conditions for $\Gamma_0(N)$}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{Definition}
  \label{def:cofactor-conditions}
  Let $M, N, m, t \in \setN$ with $M,N>0$, $t<m$.
  %
  Let $r$ be an \useterm{eta specification} of level $M$ and $s$ be an
  \useterm{eta specification} of level $N$.
  %
  Let $\modularOrbit{} \subset \Set{0,\ldots,m-1}$ and
  $\mu=\sizeOfSet{\modularOrbit{}}$.
  %
  We define the followig conditions
  %
  \begin{gather}
    \weight(s) + \mu \weight(r)
    = 0,
    \label{eq:cofactor-weight}
%    \label{eq:CDZ-sum=0}
    \\
    \rho_\infty(s) + \mu \, m \,\rho_\infty(r) +
     \frac{1-m^2}{m}\sum_{k \in \modularOrbit{}} (k + \rho_\infty(r))
    \in \setZ,
    \label{eq:cofactor-rho-infinity}
%    \label{eq:CDZ-sigmainfinity=0}
    \\
    \rho_0(s) + \frac{\mu \,m\, N}{M} \rho_0(r)
    \in \setZ.
    \label{eq:cofactor-rho-zero}
%    \label{eq:CDZ-sigma0=0}
  \end{gather}
\end{Definition}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{Theorem}\cite[Thm.~45]{Radu_RamanujanKolberg_2015}
  \label{thm:RaduConditions}
  Let $M, N, m, t, r$ fulfil the conditions of
  Definition~\ref{def:condition-co-eta-quotient-gamma0}.
  %
  Let $s$ be an \useterm{eta specification} of level $N$,
  $\modularOrbit{}=\modularOrbit{r,m,t}$ and
  $\mu=\sizeOfSet{\modularOrbit{}}$.
  %
  Additionally, let $\support(r), \support(s) \subset \setN$.
  %
  Then $F_{s,r,m,t}(\tau)$ as defined by \eqref{eq:F_s-r-m-t(tau)} is
  a modular function for $\Gamma_0(N)$ iff \eqref{eq:cofactor-weight},
  \eqref{eq:cofactor-rho-infinity}, \eqref{eq:cofactor-rho-zero}, and
  \begin{gather}
    \sqrt{
    \prod_{\delta\in\support(s)}\delta^{s_\delta}
    \prod_{\delta\in\support(r)} (m \delta)^{\mu r_\delta}
    }
    \in \setQ\label{eq:Radu-productsquare}
  \end{gather}
  hold.
\end{Theorem}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Cofactor conditions for $\Gamma_1(N)$}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{Theorem}
  \cite[Thm~10.1]{ChenDuZhao_FindingModularFunctionsRamanujan_2019}
  \label{thm:condition-co-eta-quotient-gamma1}
  Let $M, N, m, t, r$ fulfil the conditions of
  Definition~\ref{def:condition-co-eta-quotient-gamma1}.
  %
  Let $s$ be an \useterm{eta specification} of level $N$,
  $\modularOrbit{}=\Set{t}$ and $\mu=1$.
  %
  Then $F_{s,r,m,t}(\tau)$ as defined by \eqref{eq:F_s-r-m-t(tau)} is
  a modular function for $\Gamma_1(N)$ iff \eqref{eq:cofactor-weight},
  \eqref{eq:cofactor-rho-infinity}, \eqref{eq:cofactor-rho-zero}, and
  for any integer $0<a<12N$ with $\gcd(a,6)=1$ and $a \equiv_N 1$,
  \begin{gather}
    \divisorprod{N} \jacobisymbol{\delta}{a}^{\abs{s_{\delta,0}}}
    \divisorprod{M} \jacobisymbol{m \delta}{a}^{\abs{r_{\delta,0}}}
    \unityPower{\frac{a-1}{2}
      \left[
      \gensum[N] \left( \frac{g}{\delta} - \frac{1}{2}\right) s_{\delta,g}
      +
      \gensum[M] \left( \frac{g}{\delta} - \frac{1}{2}\right) r_{\delta,g}
      \right]
    }
    =
    1.
    \label{eq:CDZ-productsquare}
  \end{gather}
  Note that in \eqref{eq:CDZ-productsquare} the expression
  $\jacobisymbol{\delta}{a}$ denotes the Jacobi symbol.
\end{Theorem}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{The SubAlgebra Module Basis Algorithm:
  \algoSamba{}}%
\label{sec:Algorithm}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

In this section we present an algorithm that computes a $C[t]$-module
basis for a subalgebra of $C[x]$ and prove its termination and
correctness. The algorithm \algoSamba{} is presented in a form that
allows for relatively simple proofs.
\medskip

\noindent
Input: $t, f_1, \ldots, f_r \in R^*$, $\deg t > 0$, $\lc t = 1$.

\noindent
Output:
$B = \Set{g_0, g_1, \ldots, g_s} \subset A= C[t, f_1, \ldots, f_r]$
such that for $f\in R$ holds $\applyReduce{f}{t}{B} = 0$ iff
$f \in A$.
\begin{pseudoalgorithm}
$B := \Set{1}$
$B_{\mathrm{crit}} := \Set{f_1, \ldots, f_r}$
$d := \deg t$
$P := \emptyset$
$S := \emptyset$
while $B_{\mathrm{crit}} \cup P \cup S \neq \emptyset$ do
    $u := \textrm{``take one element from }B_{\mathrm{crit}} \cup P \cup S\textrm{ and remove it from }B_{\mathrm{crit}}\textrm{, }P\textrm{, and }S\textrm{''}$
    $u' := \applyReduce{u}{t}{B}$
    if $u' \neq 0$ then
        $B_{\mathrm{crit}} := B_{\mathrm{crit}} \cup \SetDef{b\in B}{\dividesMod[d]{u'}{b}}$
        $B := (B \setminus B_{\mathrm{crit}}) \cup \Set{u'}$
        $P := \SetDef{b_1b_2}{b_1,b_2\in B\setminus\Set{1}}$
        $S := \SetDef{t^ab}{\forall a\in\setN,b\in B \exists b'\in B: \deg(t^ab)=\deg(b')}$
return $B$
\end{pseudoalgorithm}







%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Radu's algorithm}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

A sketch of Radu's algorithm \cite{Radu_RamanujanKolberg_2015} is given as
follows. We mark the modifications for the generalized version
according to \cite{ChenDuZhao_FindingModularFunctionsRamanujan_2019}
by ``CDZ'' in parentheses.

\begin{enumerate}
\item Determine $\modularOrbit{}=\modularOrbit{r,m,t}$ by
  Definition~\ref{def:modularOrbit}.
  %
  (CDZ: Take $\modularOrbit{}=\Set{t}$.)

\item Compute $N$ such that the conditons of
  Definition~\ref{def:condition-co-eta-quotient-gamma0}
  %
  (CDZ: Definition~\ref{def:condition-co-eta-quotient-gamma1})
  %
  are fulfilled.

\item Compute an \useterm{eta specification} $s$ of level $N$ such
  that the conditions in Theorem~\ref{thm:RaduConditions}
  %
  (CDZ: Theorem~\ref{thm:condition-co-eta-quotient-gamma1})
  %
  for $F_{s,r,m,t}(\tau)$ as defined by \eqref{eq:F_s-r-m-t(tau)} to
  be a modular function for $\Gamma_0(N)$
  %
  (CDZ: $\Gamma_1(N)$)
  %
  are fulfilled. By setting up and solving an appropriate system of
  Diophantine inequalities for the orders of $F_{s,r,m,t}$ at cusps
  different from infinity, see
  \cite[Proposition~3.2.8]{Ligozat_CourbesModulaires_1975} (CDZ:
  \cite[Thm.~4]{Robins_GeneralizedDedekindEtaProducts_1994}), we can
  assume that $F_{s,r,m,t}$ has at most a pole at infinity.
\item Compute a basis $m_1,\ldots, m_k$ for the monoid of
  $\Gamma_0(N)$-modular eta-quotients according
  to Lemma~\ref{thm:modular-eta-quotient-gamma0}.
  %
  (CDZ: $\Gamma_1(N)$-modular generalized eta-quotients according
  to Lemma~\ref{thm:modular-eta-quotient-gamma1} )
  %
  with a pole at most at infinity.

\item Apply algorithm \algoSamba{}
  \cite{Hemmecke_DancingSambaRamanujan_2018} to this basis to obtain
  an order-complete basis $B=\Set{b_0,\ldots,b_{\ell-1}}$ such that
  $\setQ[m_1,\ldots,m_k] = \Module[{\setC[m_1]}]{B}$.

\item Follow reduction steps in
  \cite{Hemmecke_DancingSambaRamanujan_2018} to find polynomials
  $c_0,\ldots,c_{\ell-1} \in \setQ[x]$ such that
  \begin{gather*}
    F_{s,r,m,t}(\tau) = \sum_{i=0}^{\ell-1} c_i(m_1)b_i
  \end{gather*} which can easily turned into the right-hand side of
  \eqref{eq:Ramanujan-Kolberg-Identity}.
\end{enumerate}


















%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Transformation formulas}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Splitting of $W \in \mathrm{GL}_2^+(\setZ)$ into
  $W_1\in \SL2Z$ and upper triangular matrix $W_2$}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{Lemma}
  \label{thm:W-splitting}
  Let
  $W=\left(\begin{smallmatrix}A&B\\C&D\end{smallmatrix}\right) \in
  \mathrm{GL}_2^+(\setZ)$.
  %
  Then for $h=\gcd(A, C)>0$, $a':=\frac{A}{h}$, $c':=\frac{C}{h}$ we
  have $\gcd(a', c')=1$ and thus can find $b'$ and $d'$ such that
  $a'd'-b'c'=1$.
  %
  Let
  \begin{gather*}
    W':=\begin{pmatrix}a'&b'\\c'&d'\end{pmatrix},
    \qquad
    W''
    :=
    \begin{pmatrix}
      h &B d'-D b'\\
      0 & \det(W) / h
    \end{pmatrix}.
  \end{gather*}
  Then $W'\in \SL2Z$ and $W = W' W''$.
\end{Lemma}


Note that for any integer $s$ whe have:
\begin{align}
W = \begin{pmatrix}A&B\\C&D\end{pmatrix}
&=\begin{pmatrix}a'&b'\\c'&d'\end{pmatrix}
  \begin{pmatrix}1& s\\0&1\end{pmatrix}
  \begin{pmatrix}1&-s\\0&1\end{pmatrix}
  \begin{pmatrix}h &B d'- D b'\\0 &\det(W) / h\end{pmatrix}
  \\
&=
  \begin{pmatrix} a'&b' + a' s\\ c'&d' + c' s \end{pmatrix}
  \begin{pmatrix}
    h &B d'- D b'- s \det(W) / h\\
    0 &\det(W) / h\end{pmatrix}.
\end{align}
Therefore, we can choose $b'$ and $d'$ in such a way that
$0 \le B d'-D b' < \det(W)/h$.

Let $\tau' := W''\tau = \frac{h}{\det(W)}(h\tau + B d'- D b')$, then
$\tau'\in\setH$ and
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{gather}
\eta(W\tau) =
\eta(W'\tau') =
(c'\tau+d')^{1/2}\,\upsilon_\eta(W')\,\eta(\tau')
\label{eq:eta-W-transformation}
\end{gather}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begingroup
\newcommand{\h}{h}
\begin{Lemma}\label{thm:c*tau+d}
  Let $\gamma := \left(
    \begin{smallmatrix}a&b\\c&d\end{smallmatrix} \right)\in
  \SL2Z$, $\delta>0$, $m>0$, $z\ge0$, and
  \begin{gather*}
    W=
    \begin{pmatrix}
      \delta & z\\
      0      & m
    \end{pmatrix}
    \gamma
    = \begin{pmatrix}
        \delta a + c z & \delta b + d z\\
        c m & d m
      \end{pmatrix}
    \in \mathrm{GL}_2^+(\setZ).
  \end{gather*}
  Then $\det(W)=\delta m$.
  %
  If
  $\h:=\gcd(\delta a + c z, cm)$,
  $a':=\frac{\delta a + c z}{\h}$,
  $c':=\frac{c m}{\h}$, and
  $b'$ and $d'$ are such that $a'd'-b'c'=1$ and
  $0 \le (\delta b + d z) d' - d m b' < cm / \h$, \ie,
  \begin{gather*}
    W':=\begin{pmatrix}
      (\delta a + c z) / \h & b'\\
      c m / \h              & d'
    \end{pmatrix},
    \qquad
    W''
    :=
    \begin{pmatrix}
      \h & (\delta b + d z) d' - d m b'\\
      0  & \delta m / \h
    \end{pmatrix}.
  \end{gather*}
  according to the splitting above,
  %
  then with $\tau':=W''\tau$ we have
  $c'\tau'+d' = \frac{\h}{\delta} (c\tau + d)$.
\end{Lemma}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



\begin{proof}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{align*}
  c'\tau'+d'
  &=
  c'
    \left(
    \frac{\h}{\delta m}(h\tau + (\delta b + d z) d' - d m b')
    \right) + d'\\
  &=
    \frac{c m}{\h}
    \left(
    \frac{\h}{\delta m}(\h \tau + (\delta b + d z) d' - d m b')
    \right) + d'\\
  &=
    \frac{1}{\delta}
    \left(
    \h c \tau + b c \delta d' + c d d' z - c d m b'
    \right) + d'\\
  &=
    \frac{1}{\delta}
    \left(
    \h c \tau + (a d - 1) \delta d' + c d d' z - c d m b'
    + \delta d'
    \right)\\
  &=
    \frac{1}{\delta}
    \left(
    \h c \tau + a d \delta d' + c d d' z - c d m b'
    \right)\\
  &=
    \frac{1}{\delta}
    \left(
    \h c \tau + \h d (a' d' - c' b')
    \right)\\
  &=
    \frac{\h}{\delta} (c\tau + d)
\end{align*}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\end{proof}
\endgroup
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{Hemmecke}
  CONTINUE HERE
\end{Hemmecke}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{Hemmecke}
  CONTINUE HERE
\end{Hemmecke}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{Hemmecke}
\begin{gather}
  \defineNotation[GL2+Z]{\mathrm{GL}_2^+(\setZ)}
  :=
  \SetDef{  \begin{pmatrix}
    a & b\\
    c & d
  \end{pmatrix}}{a,b,c,d\in\setZ \land ad-bc>0}
  \label{eq:GL2+Z}
\end{gather}
\end{Hemmecke}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%







As in \cite{Radu_RamanujanKolberg_2015}, let $K(N)$ denote the set of
modular functions for $\Gamma_0(N)$ and $K^\infty(N)$ the set of
modular functions have a (multiple) pole, if any, at infinity only.
Furthermore, let $E(N)$ be the set of eta-quotients that are
modular functions, and let $E^\infty(N) := E(N)\cap K^\infty(N)$.



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Transformations of the Dedekind eta-function}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Let's look at the transformation of the eta-function (see
\cite[Lemma~2.27]{Radu_PhD_2010}).

Let
$\defineNotation[gamma]{\gamma} =
\left(\begin{smallmatrix}a&b\\c&d\end{smallmatrix}\right) \in
\SL2Z$, then
\begin{gather}
\defineNotation[eta]{\eta(\gamma\tau)} =
\eta\left(\frac{a\tau+b}{c\tau+d}\right) =
(c\tau+d)^{1/2}\,\upsilon(\gamma)\,\eta(\tau)
\label{eq:eta-transformation}
\end{gather}
where
$\defineNotation[upsilon-gamma]{\upsilon(\gamma)} :=
\upsilon_\eta(a,b,c,d)$ as defined as in
\cite[Lemma~2.27]{Radu_PhD_2010}.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{Lemma}
\label{thm:matix-splitting}
Let $\gamma',\gamma''\in \SL2Z$.
%
Then $\upsilon(\gamma'\gamma'')^2 = \upsilon(\gamma')^2 \upsilon(\gamma'')^2$.
\end{Lemma}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{proof}
  Let
  $\gamma'=\left(\begin{smallmatrix}a'&b'\\c'&d'\end{smallmatrix}\right)$
  and
  $\gamma''=\left(\begin{smallmatrix}a''&b''\\c''&d''\end{smallmatrix}\right)$
  be in $\SL2Z$.
  %
  Then
  $\gamma'\gamma'' =
  \left(
    \begin{smallmatrix}
      a'a''+b'c'' & a'b''+b'd''\\
      c'a''+d'c'' & c'b''+d'd''
    \end{smallmatrix}
  \right)$.
  We set $c:=c'a''+d'c''$ and $d:=c'b''+d'd''$.
%
  If $\tau'=\gamma''\tau$, we derive for any $\tau \in \setH$:
  \begin{gather*}
    c' \tau' + d'
    =
      \left(c' \frac{a''\tau + b''}{c''\tau + d''} +d'\right)
    =
      \left(\frac{c'a''\tau + c'b''+ d'c''\tau + d'd''}{c''\tau + d''}\right)
    =
    \left(\frac{c\tau + d}{c''\tau + d''}\right).
  \end{gather*}
%
  \begin{align*}
    (c \tau + d)^{1/2}\,\upsilon(\gamma)\,\eta(\tau)
    &=
    \eta((\gamma'\gamma'')\tau) =
    \eta(\gamma'\tau')
    =
      (c'\tau'+d')^{1/2}\,\upsilon(\gamma')\,\eta(\tau')\\
    &=
      \left(\frac{c\tau + d}{c''\tau + d''}\right)^{1/2} \,(c''\tau+d'')^{1/2}
      \,\upsilon(\gamma')\,\,\upsilon(\gamma'')\eta(\tau).
  \end{align*}
  After squaring both sides and cancelling equal terms, the statement
  of the Lemma can be concluded.
\end{proof}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Transformation of $\eta$ under $\mathrm{GL}_2^+(\setZ)$}
\label{sec:eta-transformation}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


Furthermore, let
$\defineNotation[lambda]{\lambda}\in\Set{0,\ldots,m-1}$ and
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{alignat}{2}
  \defineNotation[gammabar]{\bar{\gamma}}
  &=
    \begin{pmatrix}\delta& \delta \lambda\\0&m\end{pmatrix}
    \gamma
    =
    \gamma_1 \cdot \gamma_2
    \in \mathrm{GL}_2^+(\setZ),
    \label{eq:gammabar}
  \\
  \defineNotation[gamma1]{\gamma_1}
  &=
    \begin{pmatrix}a_1& b_1\\c_1&d_1\end{pmatrix} \in \SL2Z
  &\qquad
  \defineNotation[gamma2]{\gamma_2}
  &=
    \begin{pmatrix}a_2& b_2\\0  &d_2\end{pmatrix}
    \label{eq:gamma1}
\end{alignat}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
where $\gamma_1$ and $\gamma_2$ are defined as $W'$ and $W''$,
respectively, in Lemma~\ref{thm:c*tau+d} for $z = \delta\lambda$.

Further, $\defineNotation[u2]{u_2} = \frac{a_2}{d_2}$ and
$\defineNotation[v2]{v_2} = \frac{b_2}{d_2}$,
$\defineNotation[tau2]{\tau_2} = \gamma_2\tau = u_2\tau + v_2$.
$\defineNotation[q2]{q_2} = \unityPower{\tau_2} =
q^{u_2}\unityPower{v_2}$, and
$\defineNotation[kappa1]{\kappa_1} \in \Set{0,\ldots,23}$ is such that
$\unityPower{\frac{\kappa_1}{24}} = \upsilon(\gamma_1)$.



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

























%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Transformation of $\eta_\delta$ under $\SL2Z$}
\label{sec:eta_delta-transformation}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
Let $\delta \in \setN\setminus\Set{0}$.

\begin{gather*}
\eta_\delta(\gamma\tau)
=
\eta_\delta\left(\frac{a\tau+b}{c\tau+d}\right) =
\eta\left(\frac{a\delta\tau+b\delta}{c\tau+d}\right)
=
\eta\left(\begin{pmatrix}a\delta&b\delta\\c&d\end{pmatrix}
  \tau\right).
\end{gather*}

Let
%
\begin{gather}
  \defineNotation[h-delta]{h_\delta}
  :=
  \gcd(\delta a,c), \label{eq:h_delta}
\end{gather}
%
$\defineNotation[a-delta]{a_\delta}:=\frac{\delta a}{h_\delta}$,
%
$\defineNotation[c-delta]{c_\delta}:=\frac{c}{h_\delta}$,
%
and $\defineNotation[b-delta]{b_\delta}$ and
$\defineNotation[d-delta]{d_\delta}$ are chosen in such a way that
$a_\delta d_\delta - b_\delta c_\delta = 1$.
%
Because of $\gcd(a_\delta, c_\delta)=1$, such $b_\delta$ and $d_\delta$
can be found.
%
Therefore
  $\defineNotation[gamma-delta]{\gamma_\delta} := \left(
  \begin{smallmatrix}a_\delta&b_\delta\\c_\delta&d_\delta\end{smallmatrix}
\right)\in \SL2Z$.

Note that $h_\delta=\gcd(\delta, c)$, because $\gcd(a,c)=1$ and,
furthermore,
\begin{align}
\begin{pmatrix}a\delta&b\delta\\c&d\end{pmatrix}
&=\begin{pmatrix}a_\delta&b_\delta\\c_\delta&d_\delta\end{pmatrix}
  \begin{pmatrix}h_\delta&\delta b d_\delta-d b_\delta\\
                 0      &\delta / h_\delta\end{pmatrix}.
\label{eq:naive-matrix-split}
\end{align}
Note that for any integer $s$ whe have:
\begin{align*}
\begin{pmatrix}a\delta&b\delta\\c&d\end{pmatrix}
&=\begin{pmatrix}a_\delta&b_\delta\\c_\delta&d_\delta\end{pmatrix}
  \begin{pmatrix}1& s\\0&1\end{pmatrix}
  \begin{pmatrix}1&-s\\0&1\end{pmatrix}
  \begin{pmatrix}
    h_\delta&\delta b d_\delta-d b_\delta\\
    0      &\delta / h_\delta\end{pmatrix}
  \\
&=
  \begin{pmatrix}
    a_\delta&b_\delta + a_\delta s\\
    c_\delta&d_\delta + c_\delta s
  \end{pmatrix}
  \begin{pmatrix}h_\delta&\delta b d_\delta-d b_\delta-s \delta / h_\delta\\
                 0      &\delta / h_\delta\end{pmatrix}.
\end{align*}
Therefore, we can choose $b_\delta$ and $d_\delta$ in such a way that
$0 \le \delta b d_\delta-d b_\delta < \delta/h_\delta$.

If $c=0$, then $a=d=1$, $h_\delta=\delta$. We can choose $d_\delta=1$
and $b_\delta= \delta b  d_\delta$ and get
\begin{align}
\begin{pmatrix}\delta&b\delta\\0&1\end{pmatrix}
&=\begin{pmatrix}1&b \delta\\0&1\end{pmatrix}
  \begin{pmatrix}\delta&0\\
                 0      &1\end{pmatrix}.
\end{align}

If we set
\begin{gather}
  \defineNotation[tau-delta]{\tau_\delta}
  :=
  \begin{pmatrix}
    h_\delta & \delta b d_\delta-d b_\delta\\
    0       & \delta / h_\delta
  \end{pmatrix} \tau
  =
  \frac{h_\delta\tau+\delta b d_\delta-d b_\delta}{\delta/h_\delta},
  \label{eq:tau_delta}
\end{gather}
then
\begin{gather*}
  \eta_\delta(\gamma\tau)
  =
  \eta(\gamma_\delta \tau_\delta)
  =
  (c_\delta\tau_\delta+d_\delta)^{1/2}
  \,
  \upsilon(\gamma_\delta)
  \,
  \eta(\tau_\delta).
\end{gather*}


From Lemma~\ref{thm:c*tau+d} we get
\begin{align*}
  c_\delta\tau_\delta+d_\delta
  &=
  \frac{h_\delta}{\delta}(c \tau + d).
\end{align*}

Thus, we have
\begin{gather}
\eta_\delta(\gamma\tau)
=
\left(\frac{h_\delta}{\delta}(c \tau+d)\right)^{\!1/2}
\unityPower{\frac{\kappa_\delta}{24}}
\,
\eta(\tau_\delta).
\label{eq:eta_delta(gamma*tau)}
\end{gather}
where
$\defineNotation[kappa-delta]{\kappa_\delta} \in \Set{0,\ldots,23}$ is
defined by
\begin{gather}
  \label{eq:kappa_delta}
  \unityPower{\frac{\kappa_\delta}{24}} := \upsilon(\gamma_\delta).
\end{gather}
Note that for
$\gamma=\left(\begin{smallmatrix}1&0\\0&1\end{smallmatrix}\right)$ we
have $\kappa_\delta=0$ for any $\delta$.


For the following definition see \cite[Lemma~2.37]{Radu_PhD_2010} and
\cite[Definition~2.9]{Radu_PhD_2010}.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Note that for
$\gamma=\left(\begin{smallmatrix}1&0\\0&1\end{smallmatrix}\right)$ we
have $w_\gamma=1$.


For
$\gamma =
\bigl(
\begin{smallmatrix}
  a & b\\
  c & d
\end{smallmatrix}
\bigr) \in \SL2Z$ we want to expand $\eta(\tau_\delta)$ in
$\defineNotation[x]{x}:=q^{1/w_\gamma}=\unityPowerTau{\frac{1}{w_\gamma}}$
with coefficients from $\setQ(\xi)$ where
$\defineNotation[xi]{\xi} := \unityPower{\frac{c}{24N}}$.

Since we are only interested in expansions at the cusps, we can assume
$0<c\in\Delta$.

In the following let $\delta \in \Delta$. Because of
$x=q^{1/w_\gamma}$, \eqref{eq:tau_delta} and \eqref{eq:width0}, we
have
\begin{gather}
  \defineNotation[q-delta]{q_\delta} = \unityPower{\tau_\delta}
  = q^{u_\delta} \, \unityPower{v_\delta}
  = x^{e_\delta} \, \unityPower{v_\delta}
\label{eq:q_delta}
\end{gather}
for
\begin{gather}
  \defineNotation[u-delta]{u_\delta} :=
  \frac{h_\delta^2}{\delta},
  \qquad
  \defineNotation[e-delta]{e_\delta} :=
  w_\gamma u_\delta,
  \qquad
  \defineNotation[v-delta]{v_\delta} :=
  \frac{\delta b d_\delta-d b_\delta}{\delta/h_\delta}.
  \label{eq:uv_delta}
\end{gather}
Note that for
$\gamma=\left(\begin{smallmatrix}1&0\\0&1\end{smallmatrix}\right)$,
i.e., if $c=0$, then $a=d=1$ and
$w_\gamma=1$,
$h_\delta=\delta$, $u_\delta=e_\delta=\delta$, $v_\delta=0$.

%
Note that $\unityPower{\frac{v_\delta}{24}} = \xi^k$ for
$k = (\delta b d_\delta - d b_\delta) \frac{N}{\lcm(\delta,c)}\in \setZ$.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{Lemma}
  If $\gamma =
\bigl(
\begin{smallmatrix}
  a & b\\
  c & d
\end{smallmatrix}
\bigr) \in \SL2Z$, $N > 0$, $\delta \in \Delta$, then
$e_\delta \in \setZ$.
\end{Lemma}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{proof}
If $c=0$, then $e_\delta=\delta\in\setZ$. Without loss of generality,
we can assume $c>0$.
If $p$ is a prime that divides $N$, \ie, $N=N'p^\alpha$ for some
$\alpha>0$, and $\delta = \delta' p^m$, $c=c' p^k$ with
$\gcd(p,N')=\gcd(p,\delta')=\gcd(p,c')=1$, then
\begin{align*}
  e_\delta
  &=
  \frac{N}{\gcd(c^2,N)} \frac{\gcd(\delta,c)^2}{\delta}\\
  &=
  \frac{p^\alpha N' \gcd(p^m \delta', p^k c')^2}{\gcd(p^{2k}
    c'^2,p^\alpha N') p^m \delta'}\\
  &=
  p^{\alpha + 2 \min(m,k) - m - \min(2k, \alpha)}
  \frac{N' \gcd(\delta', c')^2}{\gcd(c'^2, N') \delta'}
\end{align*}
If we can show that $e:=\alpha + 2 \min(m,k) - m - \min(2k,
\alpha)\ge0$ then $e_\delta\in\setN$ follows by repeating the above
process for every prime divisor of $N$.

There are several cases to consider:
\begin{itemize}
\item $0\le m\le k \le \alpha$, $2k \le \alpha$. Then
  $e=\alpha+2m-m-2k=(\alpha-2k)+m\ge0$.
\item $0\le m\le k \le \alpha < 2k$. Then
  $e=\alpha+2m-m-\alpha=m\ge0$.

\item $0\le k\le m \le \alpha$, $2k \le \alpha$. Then
  $e=\alpha+2k-m-2k=\alpha-m\ge0$.
\item $0\le k\le m \le \alpha < 2k$. Then
  $e=\alpha+2k-m-\alpha=2k-m\ge0$.
\end{itemize}
\end{proof}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

We can expand $\eta(\tau_\delta)$ in terms of $x$ as follows.
\begin{gather*}
  \eta(\tau_\delta)
  =
    \unityPower{{\frac{\tau_\delta}{24}}}
    \prod_{n=1}^{\infty}(1-q_\delta^n)
  =
  \unityPower{\frac{v_\delta}{24}} x^{e_\delta/24}
  \cdot
  \prod_{n=1}^{\infty}(1-q_\delta^n).
\end{gather*}

Then \eqref{eq:eta_delta(gamma*tau)} turns into
\begin{align}
\eta_\delta(\gamma\tau)
&=
(c \tau+d)^{1/2}
\,
\left(\frac{h_\delta}{\delta}\right)^{\!\frac{1}{2}}
\,
  \unityPower{\frac{v_\delta + \kappa_\delta}{24}}
  q^{u_\delta/24} \cdot \eulerFunction[q^{u_\delta} \unityPower{v_\delta}]{}
\label{eq:eta_delta(gamma*tau)-expansion}
\end{align}
where the values are given through \eqref{eq:h_delta},
\eqref{eq:kappa_delta}, \eqref{eq:width0}, \eqref{eq:q_delta},
\eqref{eq:uv_delta}, and $x=\unityPowerTau{\frac{1}{w_\gamma}}$.



The parts of \eqref{eq:eta_delta(gamma*tau)-expansion} are implemented
via \textcolor{blue}{\code{SymbolicEtaGamma}}
(Section~\ref{sec:SymbolicEtaGamma}).
\\
If \code{e = eta(nn, delta, gamma)}, then we have the following
correspondence.
\begin{align*}
\text{\code{rationalPrefactor(e) : Q}} &= \frac{h_\delta}{\delta},\\
\text{\code{udelta(e) : Q}}            &= u_\delta,\\
\text{\code{vdelta(e) : Q}}            &= v_\delta,\\
\text{\code{upsilonExponent(e) : Z}}   &= \kappa_\delta.
\end{align*}






%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Transformation of $\eta_{\delta,m,\lambda}$ under
  $\SL2Z$}
  \label{sec:transformation-eta_delta-m-lambda}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

In the following let
$\defineNotation[m]{m},
\defineNotation[M]{M},
N \in \setN \setminus \Set{0}$, and
$r \in R(M)$
be subject to the following conditions
\begin{gather}
  \text{for every prime $p$ with $\divides{p}{m}$ follows $\divides{p}{N}$,}
  %\label{eq:p|m=>p|N}
  \\
  \text{and, if $\divides{\delta}{M}$ and $r_\delta\ne0$, then
    $\divides{\delta}{mN}$.}
  %\label{eq:delta|M=>delta|mN}
\end{gather}

For the above conditions see (13) and (14) in
\cite{Radu_AlgorithmicApproachRamanujanCongruences_2009} or
Section~4.2 in \cite{Radu_PhD_2010}.

Furthermore, we fix $t\in\Set{0,\ldots,m-1}$.

Let $\defineNotation[lambda]{\lambda} \in \Set{0,\ldots,m-1}$, and
$\divides{\delta}{M}$.
%
We define
\begin{gather}
  \defineNotation[eta-delta-m-lambda-tau]{\eta_{\delta,m,\lambda}}(\tau)
  := \eta \left(
    \begin{pmatrix}\delta& \delta \lambda\\0&m\end{pmatrix} \tau
  \right).
\label{eq:eta_delta-m-lambda(tau)}
\end{gather}

Let
$\gamma=\left(\begin{smallmatrix}a&b\\c&d\end{smallmatrix}\right) \in
\SL2Z$.
%
Then
\begin{align}
  \eta_{\delta,m,\lambda}(\gamma \tau)
  &:= \eta
\left(
  \begin{pmatrix}\delta& \delta \lambda\\0&m\end{pmatrix}
  \gamma
  \tau
\right)
=
\eta(W \tau)
\end{align}
where
\begin{align}
  \defineNotation[W]{W}
  &:=
  \begin{pmatrix}
    \delta (a + c \lambda) & \delta (b + d \lambda)\\
    c m                   & d m
  \end{pmatrix}.
  \label{eq:W_delta-m-lambda}
\end{align}

Setting $z = \delta \lambda$ in Lemma~\ref{thm:c*tau+d}, we get the
splitting of $W = W' W''$ as
%
\begin{gather}
  \defineNotation[W']{W'}
  =
  \begin{pmatrix}
    a' & b'\\
    c' & d'
  \end{pmatrix}
  = \begin{pmatrix}
      \delta(a+c \lambda)/h_{\delta,m,\lambda} & b'\\
      cm/h_{\delta,m,\lambda}                  & d'
    \end{pmatrix},
  \qquad
  \defineNotation[W'']{W''}
  =
  \begin{pmatrix}
    h_{\delta,m,\lambda} & \delta (b + d \lambda) d' - d m b'\\
    0               & \delta m / h_{\delta,m,\lambda}
  \end{pmatrix}
  \label{eq:split-W_delta-m-lambda}
\end{gather}
where $b'$ and $d'$ have been chosen in such a way that
$0\le  \delta (b + d \lambda) d' < \delta m / h_{\delta,m,\lambda}$.
and
\begin{gather}
  \defineNotation[h-delta-m-lambda]{h_{\delta,m,\lambda}} :=
  \gcd(\delta (a + c \lambda), cm).
\end{gather}

Let us define
\begin{gather}
  \defineNotation[u-delta-m-lambda]{u_{\delta,m,\lambda}}
  :=
  \frac{h_{\delta,m,\lambda}^2}{\delta m},
  \qquad
  \defineNotation[v-delta-m-lambda]{v_{\delta,m,\lambda}}
  :=
  \frac{h_{\delta,m,\lambda}(\delta (b + d \lambda) d' - d m b')}{\delta m}.
  \label{eq:uv_delta-m-lambda}
\end{gather}

And further,
\begin{align}
  \defineNotation[gamma-delta-m-lambda]{\gamma_{\delta,m,\lambda}}
  &:=
    W'\in\SL2Z,
    \label{eq:gamma_delta-m-lambda}
  \\
  \defineNotation[tau-delta-m-lambda]{\tau_{\delta,m,\lambda}}
  &:=
    W''\tau
    = \frac{h_{\delta,m,\lambda}^2 \tau}{\delta m} +
    \frac{h_{\delta,m,\lambda}(\delta (b + d \lambda) d' - d m
    b')}{\delta m}
  \notag\\
    &= u_{\delta,m,\lambda} \tau + v_{\delta,m,\lambda}.
  \label{eq:tau_delta-m-lambda}
\end{align}
Then
$\defineNotation[q-delta-m-lambda]{q_{\delta,m,\lambda}} :=
\unityPower{\tau_{\delta,m,\lambda}} =
q^{u_{\delta,m,\lambda}}\,\unityPower{v_{\delta,m,\lambda}}$.


Lemma~\ref{thm:c*tau+d} tells us
$c'\tau_{\delta,m,\lambda}+d' = \frac{h_{\delta,m,\lambda}}{\delta} (c \tau + d)$.
%
Therefore,
\begin{align}
  \defineNotation[eta_delta-m-lambda-gamma-tau]{\eta_{\delta,m,\lambda}(\gamma \tau)}
  &= \eta(W \tau)
    = (c'\tau'+d')^{1/2} \, \upsilon(\gamma_{\delta,m,\lambda})
    \,\eta(\tau_{\delta,m,\lambda})\notag\\
  &=
    (c\tau+d)^{1/2}
    \left(\frac{h_{\delta,m,\lambda}}{\delta}\right)^{1/2}
    \unityPower{\frac{\kappa_{\gamma_{\delta,m,\lambda}}}{24}} \,
    q_{\delta,m,\lambda}^{1/24}
    \prod_{n=1}^\infty (1-q_{\delta,m,\lambda}^n)\notag\\
  &=
    (c\tau+d)^{1/2}
    \left(\frac{h_{\delta,m,\lambda}}{\delta}\right)^{1/2}
    \unityPower{\frac{ v_{\delta,m\lambda} + \kappa_{\gamma_{\delta,m,\lambda}}}{24}}
    q^{u_{\delta,m,\lambda}/24}
    \eulerFunction[q_{\delta,m,\lambda}]{}\notag\\
  &=
    (c\tau+d)^{1/2}
    \left(\frac{h_{\delta,m,\lambda}}{\delta}\right)^{1/2}
    \unityPower{\frac{ v_{\delta,m\lambda} + \kappa_{\gamma_{\delta,m,\lambda}}}{24}}
    q^{u_{\delta,m,\lambda}/24}
    \eulerFunction[q^{u_{\delta,m,\lambda}}\,\unityPower{v_{\delta,m,\lambda}}]{}
    \label{eq:eta_delta-m-lambda(gamma*tau)}
\end{align}
where
$\defineNotation[kappa-gamma-delta-m-lambda]{\kappa_{\gamma_{\delta,m,\lambda}}}
\in \Set{0,\ldots,23}$ is defined by
$\unityPower{\frac{\kappa_{\gamma_{\delta,m,\lambda}}}{24}} =
\upsilon(\gamma_{\delta,m,\lambda})$.

The parts of \eqref{eq:eta_delta-m-lambda(gamma*tau)} are implemented
via \textcolor{blue}{\code{SymbolicEtaGamma}}
(Section~\ref{sec:SymbolicEtaGamma}).
\\
If \code{e = eta(mm, delta, m, lambda, gamma)}, then we have the
following correspondence.
\begin{align*}
  \text{\code{rationalPrefactor(e) : Q}}
  &=
    \frac{h_{\delta,m,\lambda}}{\delta},
  \\
  \text{\code{udelta(e) : Q}}
  &=
    u_{\delta,m,\lambda},
  \\
  \text{\code{vdelta(e) : Q}}
  &=
    v_{\delta,m,\lambda},
  \\
  \text{\code{upsilonExponent(e) : Z}}
  &=
    \kappa_{\gamma_{\delta,m,\lambda}}.
\end{align*}



We expand $\eta_{\delta,m,\lambda}(\gamma \tau)$ into a Laurent series
in $z_m$ with coefficients from $\setQ(\xi_m)$ where
$\xi_m := \unityPower{\frac{1}{24 m N}}$. Note that
$\unityPower{\frac{v_{\delta,m,\lambda}}{24}}=\xi_m^k$ for
$k=\frac{N}{\delta} h_{\delta,m,\lambda}(\delta (b + d \lambda) d' - d
m b') \in \setZ$.
\begin{Hemmecke}
  $\xi_m$ is not yet what we want.
\end{Hemmecke}






%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Transformations of Dedekind eta-quotients}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Transformation of $g_r$ under $\SL2Z$}
\label{sec:g_r-transformation}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{Definition}
  For any $c, \delta \in\Delta$, $r\in R(N)$ let us define
  \begin{align}
    \defineNotation[a-N]{a_N}(c, \delta)
    &:= \frac{N}{\gcd(N, c^2)} \frac{\gcd(c,\delta)^2}{\delta},
      \notag\\
    \defineNotation[ord-c-N]{\ord_c^N}(r)
    &:= \frac{1}{24}\divisorsum{N} a_N(c, \delta) \, r_\delta.
    \label{eq:order-r}
  \end{align}
\end{Definition}

With $\defineNotation[ord-gamma-N]{\ord_\gamma^N}$ as defined in
\cite{Radu_RamanujanKolberg_2015}, Theorem~23 of
\cite{Radu_RamanujanKolberg_2015} turns into
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{Theorem}\label{thm:order}
  Let $\gamma =
  \bigl(
  \begin{smallmatrix}
    a & b\\
    c & d
  \end{smallmatrix}
  \bigr)
  \in \SL2Z$ with $c\in\Delta$.
  If $r \in R^*(N)$, then
  $\ord_\gamma^N(g_r) = \ord_c^N(r)$.
\end{Theorem}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
For a proof we refer to
\cite[Proposition~3.2.8]{Ligozat_CourbesModulaires_1975}.

In the following let us fix $r \in R(N)$ and
$\gamma =
  \bigl(
  \begin{smallmatrix}
    a & b\\
    c & d
  \end{smallmatrix}
  \bigr)
  \in \SL2Z$ with $c \in \Delta$.

From \eqref{eq:eta_delta(gamma*tau)-expansion} follows
\begin{align}
  \defineNotation[g-r-gamma-tau]{g_r(\gamma \tau)}
  &=
  \divisorprod{N}
  (c \tau+d)^{r_\delta/2}
  \,
  \left(\frac{h_\delta}{\delta}\right)^{\!r_\delta/2}
  \,
  \unityPower{\frac{r_\delta(v_\delta + \kappa_\delta)}{24}}
  \cdot
  q^{r_\delta u_\delta/24}
  \cdot
    \prod_{n=1}^{\infty}(1-q_\delta^n)^{r_\delta}
  \notag
  \\
  %
  &=
  (c \tau+d)^{\divisorsum{N} \frac{r_\delta}{2}}
  \cdot
  \divisorprod{N}
  \left(\frac{h_\delta}{\delta}\right)^{\!r_\delta/2}
  \cdot
  \unityPower{\divisorsum{N} \frac{r_\delta(v_\delta + \kappa_\delta)}{24}}
  \cdot
  q^{\divisorsum{N} \frac{r_\delta u_\delta}{24}}
  \cdot
  \divisorprod{N} \eulerFunction[q_\delta]{}^{r_\delta}.
  \label{eq:g_r(gamma*tau)}
\end{align}

Note that for
$\gamma=\left(\begin{smallmatrix}1&0\\0&1\end{smallmatrix}\right)$ the
first three products are equal to 1.


The parts of \eqref{eq:g_r(gamma*tau)} are implemented via
\textcolor{blue}{\code{SymbolicEtaQuotientGamma}}
(Section~\ref{sec:SymbolicEtaQuotientGamma}).
\\
If \code{e = eta(nn, r, gamma)}, then we have the following
correspondence.
\begin{align*}
  \text{\code{rationalPrefactor(e) : Q}}
  &=
    \divisorprod{N} \left(\frac{h_\delta}{\delta}\right)^{\!r_\delta},
  \\
  \text{\code{unityExponent(e) : Q}}
  &=
    \divisorsum{N} \frac{r_\delta(v_\delta + \kappa_\delta)}{24},
  \\
  \text{\code{qExponent(e) : Q}}
  &=
    \divisorsum{N} \frac{r_\delta u_\delta}{24},
\end{align*}

If $r\in R^*(N)$, then $g_r$ is a modular function on $\Gamma_0(N)$.
Because of \eqref{eq:sum=0}, $q^{u_\delta}=x^{e_\delta}$,
$e_\delta=a_N(c, \delta)$, and \eqref{eq:order-r}, we can write
\begin{align}
  g_r(\gamma \tau)
  &=
  \divisorprod{N}
  \left(\frac{h_\delta}{\delta}\right)^{\!r_\delta/2}
  \cdot
  \unityPower{\divisorsum{N} \frac{r_\delta(v_\delta + \kappa_\delta)}{24}}
  \cdot
  x^{\ord^N_c(r)}
  \cdot
  \divisorprod{N} \eulerFunction[q_\delta]{}^{r_\delta}.
  \label{eq:modular-g_r(gamma*tau)}
\end{align}
Thus, we can expand $g_r(\gamma\tau)$ as a Laurent series in
$x:=q^{1/w_\gamma}$ with coefficients from $\setQ(\xi)$.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Transformation of $g_{r,m,\lambda}$ under $\SL2Z$}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

As abbreviation, we define the function
\begin{align}
  \defineNotation[g-r-m-lambda-tau]{g_{r,m,\lambda}(\tau)}
  &:=
  \divisorprod{M}
  \eta\left(\frac{\delta(\tau+\lambda)}{m}\right)^{r_\delta}
  =
  g_r\!\left(\frac{\tau+\lambda}{m}\right)
  \label{eq:g_r-m-lambda(tau)}
\end{align}

From its definition~\eqref{eq:g_r-m-lambda(tau)} and
\eqref{eq:eta_delta-m-lambda(gamma*tau)}, we can easily find a formula
for the transformation of $g_{r,m,\lambda}$ under $\SL2Z$.

\begin{align}
  \defineNotation[g-r-m-lambda-gamma-tau]{g_{r,m,\lambda}(\gamma\tau)}
  &=
%    \unityPower{-\frac{\lambda}{24m}\Bigl(24t+\sigmainfty{r}\Bigr)}
    \divisorprod{M}
    \eta_{\delta,m,\lambda}(\gamma\tau)^{r_\delta}\notag\\
  \begin{split}
  &=
    (c\tau+d)^{\divisorsum{M} \frac{r_\delta}{2}} \cdot
%    \unityPower{-\frac{\lambda}{24m}\Bigl(24t+\sigmainfty{r}\Bigr)}
%    \cdot
    \unityPower{\divisorsum{M}\frac{r_\delta(v_{\delta,m,\lambda} +
    \kappa_{\gamma_{\delta,m,\lambda}})}{24}} \times\\
  & \qquad\times
    \divisorprod{M}
    \left(\frac{h_{\delta,m,\lambda}}{\delta}\right)^{\!\frac{r_\delta}{2}}
    \cdot
    \unityPowerTau{\frac{\divisorsum{M} r_\delta u_{\delta,m,\lambda}}{24}}
    \cdot
    \divisorprod{M}
    \eulerFunction[q_{\delta,m,\lambda}]{}^{r_\delta}
  \end{split}
  \label{eq:g_r-m-lambda(gamma*tau)}
\end{align}

The parts of \eqref{eq:g_r-m-lambda(gamma*tau)} are implemented via
\textcolor{blue}{\code{SymbolicEtaQuotientLambdaGamma}}
(Section~\ref{sec:SymbolicEtaQuotientLambdaGamma}).
\\
If \code{e = etaQuotient(mm, delta, m, lambda, gamma)}, then we have the
following correspondence.
\begin{align*}
  \text{\code{rationalPrefactor(e) : Q}}
  &=
    \divisorprod{M}
    \left(\frac{h_{\delta,m,\lambda}}{\delta}\right)^{\!r_\delta},
  \\
  \text{\code{unityExponent(e) : Q}}
  &=
    \divisorsum{M} \frac{r_\delta(v_{\delta,m,\lambda} + \kappa_{\delta,m,\lambda})}{24}
  \\
  \text{\code{qExponent(e) : Q}}
  &=
    \divisorsum{M} \frac{r_\delta u_{\delta,m,\lambda}}{24}
\end{align*}

Note that
\begin{align}
  \defineNotation[p-gamma-lambda]{p(\gamma,\lambda)}
  &=
    \divisorsum{M} \frac{r_\delta u_{\delta,m,\lambda}}{24}
\end{align}
where $p(\gamma,\lambda)$ is as defined in Lemma~3.4 (equation~(50))
of \cite{Radu_AlgorithmicApproachRamanujanCongruences_2009}.







%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Root of unity reduction}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Note that any modular function (in particular $g_r$) can be expressed
as a rational function $f$ in $j$ and $j_N$ where
$j_N(\tau):=j(N\tau)$ and $j$ is Klein's $j$-invariant, \ie,
$g_r(\tau)=f(j, j_N)(\tau) := f(j(\tau), j(N\tau))$.

Let $\frac{a}{c}$ be a cusp of $\Gamma_0(N)$.
%
We can choose $b$ and $d$ such that
%
$\gamma := \bigl(
\begin{smallmatrix}
  a & b\\
  c & d
\end{smallmatrix}
\bigr) \in \SL2Z$ and $\gamma\infty=\frac{a}{c}$.
%
Klein's $j$-function is invariant under any modular transformation.
%
Let us consider the transformation of $j_N$ by $\gamma$.
%
According to \eqref{eq:tau_delta} for $\delta=N$, $j_N(\gamma\tau)$
can be expanded into a Laurent series in
$x=q^{1/w_\gamma}=\unityPowerTau{1/w_\gamma}$ with
coefficients from $\setQ(\xi)$ where $\xi$ is a $\frac{N}{c}$-th root
of unity.
%
Since there is some freedom to choose such $b$ and $d$, we show in the
following, how we can obtain an expansion of $j_N(\gamma\tau)$ and
therefore (via $f$) an expansion $g_r(\gamma\tau)$ into a Laurent
series in $x$ with coefficients in $\setQ(\xi)$ where $\xi$ is a
$v$-th root of unity and $1 \leq v \le N/c$ and $v<N/c$ if $c<N$.

Let
$\gamma' = \bigl(
\begin{smallmatrix}
  a & b'\\
  c & d'
\end{smallmatrix}
\bigr) \in \SL2Z$, then also
\begin{align*}
  \gamma
  &:=
    \begin{pmatrix}
      a & b' + as\\
      c & d' + cs
    \end{pmatrix}
  =
    \begin{pmatrix}
      a & b'\\
      c & d'
    \end{pmatrix}
    \begin{pmatrix}
      1 & s\\
      0 & 1
    \end{pmatrix}
    \in \SL2Z
\end{align*}
for any $s\in\setZ$.

For the transformation of $j_N$, we split the matrix as in
\eqref{eq:naive-matrix-split} with $\delta=N$.
\begin{align*}
  \begin{pmatrix}
    N a & N(b' + as)\\
    c & d' + cs
  \end{pmatrix}
      &=
  \begin{pmatrix}
    N a/c & -1\\
    1     &  0
  \end{pmatrix}
  \begin{pmatrix}
    c & cs+d'\\
    0 & N/c
  \end{pmatrix}
\end{align*}
into an element of $\SL2Z$ and a triangular matrix.
%
Then we determine natural numbers $u$ and $v$ such that $u v = N/c$
and $\gcd(c, u)=1$. Thus, we can find $s \in \setZ$ such that
$s \equiv_u -d'c^{-1}$, \ie, $cs + d' = tu$ for some integer
$t$ with $0\le t<c$.
%
Thus,
\begin{gather*}
  \begin{pmatrix}
    c & cs+d'\\
    0 & N/c
  \end{pmatrix} \tau
  =
  \begin{pmatrix}
    c & u t\\
    0 & u v
  \end{pmatrix} \tau
  =
  \frac{c^2}{N} \tau + \frac{t}{v}
  =
 \frac{w_\gamma c^2}{N} \frac{\tau}{w_\gamma} + \frac{t}{v}
  =
 \frac{c}{\gcd(c,N/c)} \frac{\tau}{w_\gamma} + \frac{t}{v}
  .
\end{gather*}
Note that $u=N/c$ and $v=1$, if $N$ is squarefree.

With the particular $s$ from above, we define $b:=b'+as$, $d:=d'+cs$
and take
%
$\gamma = \bigl(
\begin{smallmatrix}
  a & b\\
  c & d
\end{smallmatrix}
\bigr)$ as the transformation matrix that belongs to the cusp
$\frac{a}{c}$.




%$
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Transformations of $\sum_{n=0}^\infty a(mn+k) q^n$}
\label{sec:p_r-m-k}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

In the following let $\defineNotation[m]{m}, \defineNotation[M]{M}, N
\in \setN \setminus \Set{0}$, $r \in
R(M)$, and
$t\in\Set{0,\ldots,m-1}$ be subject to the conditions
\eqref{eq:p|m=>p|N} and \eqref{eq:delta|M=>delta|mN}.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Let
\begin{gather*}
  f(\tau)
  =
  \sum_{n=0}^\infty a(n) q^n
  =
  \divisorprod{M}\prod_{n=1}^\infty(1-q^{\delta n})^{r_\delta}
  =
  \divisorprod{M}\eulerFunction{\delta}^{r_\delta}
  =
  \unityPowerTau{-\rho_\infty(r)} g_r(\tau)
\end{gather*}
be the generating function for the sequence $(a(n))_{n\in\setN}$.

In the following we consider the function
$p_{r,m,k}(\tau)$ as given by \eqref{eq:p_r-m-k(tau)}.
and its transformations under $\SL2Z$.

Note that $g_r = g_{r,1,0}=p_{r,1,0}$.

We aim at the expansion of $p_{r,m,k}(\tau)$ at all cusps
$\gamma = \left(
  \begin{smallmatrix}a&b\\c&d\end{smallmatrix} \right)\in \SL2Z$
of $\Gamma_0(N)$ into Puiseux series in $x=q^{1/w_\gamma}$ or rather
into Laurent series in
$\defineNotation[z]{z} := q^{\frac{1}{24 w_\gamma}}$. Temporarily (for
the expansion of $\eta_{\delta,m,\lambda}$) we will expand into
Laurent series in
$\defineNotation[z-m]{z_m} := q^{\frac{1}{24 m w_\gamma}}$.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Transformation of $p_{r,m,t}$ under $\SL2Z$}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

From its definition~\eqref{eq:p_r-m-t(tau)} and
\eqref{eq:g_r-m-lambda(gamma*tau)}, we can easily find a formula for
the transformation of $p_{r,m,t}$ under $\SL2Z$.

\begin{align}
  \defineNotation[p-r-m-t-gamma-tau]{p_{r,m,t}(\gamma\tau)}
  &:=\frac{1}{m} \sum_{\lambda=0}^{m-1}
    \unityPower{-\frac{\lambda}{m}\Bigl(t+\rho_\infty(r)\Bigr)}
    g_{r,m,\lambda}(\gamma\tau)\notag\\
  \begin{split}
  &=
    \frac{(c\tau+d)^{\divisorsum{M} \frac{r_\delta}{2}}}{m}
    \sum_{\lambda=0}^{m-1}
    \unityPower{-\frac{\lambda}{m}\Bigl(t+\rho_\infty(r)\Bigr)
    + \divisorsum{M}\frac{r_\delta(v_{\delta,m\lambda} +
    \kappa_{\gamma_{\delta,m,\lambda}})}{24}} \times\\
  & \qquad\times
    \divisorprod{M}
    \left(\frac{h_{\delta,m,\lambda}}{\delta}\right)^{\!\frac{r_\delta}{2}}
    \cdot
    \unityPowerTau{\frac{\divisorsum{M} r_\delta u_{\delta,m,\lambda}}{24}}
    \cdot
    \divisorprod{M}
    \eulerFunction[q_{\delta,m,\lambda}]{}^{r_\delta}
  \end{split}
  \label{eq:p_r-m-t(gamma*tau)}
\end{align}

The parts of \eqref{eq:p_r-m-t(gamma*tau)} are implemented via
\textcolor{blue}{\code{SymbolicEtaQuotientGamma}}
(Section~\ref{sec:SymbolicEtaQuotientGamma}).
\\
If \code{e = etaQuotient(mm, r, m, t, gamma)}, then we have the
following correspondence.
\begin{align*}
  \text{\code{unityExponent(e) : Q}}
  &=
    -\frac{t+\rho_\infty(r)}{m}
\end{align*}






%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Find ``$\Gamma_0(N)$-modular'' cofactor for $p_{r,m,t}(\tau)$}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{Definition}\cite[Def.~44]{Radu_RamanujanKolberg_2015}
  Given $t\in\Set{0,\ldots,m-1}$, $r \in R(M)$, $s \in R(N)$, we
  define
  \begin{align}
    \defineNotation[P-r-m-t-tau]{P_{r, m, t}(\tau)}
    &:= \prod_{k \in \modularOrbit{r,m,t}} p_{r,m,k}(\tau)\\
    %
    \defineNotation[F-s-r-m-t-tau]{F_{s, r, m, t}(\tau)}
    &:= \divisorprod{N} \eta(\delta\tau)^{s_\delta} \cdot P_{r, m, t}(\tau)
  \end{align}
\end{Definition}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
By \eqref{eq:p_r-m-t(tau)} we can write the following.
\begin{align}
  \defineNotation[P-r-m-t]{P_{r, m, t}(\tau)}
  &:= \prod_{k \in \modularOrbit{r,m,t}}
    \unityPowerTau{\frac{k+\rho_\infty(r)}{m}} (U_mf_{k})(\tau)\\
  &:= \prod_{k \in \modularOrbit{r,m,t}}
    \left[\unityPowerTau{\frac{k+\rho_\infty(r)}{m}}
    \cdot \sum_{n=0}^\infty a(mn+k) q^n\right]
  \\
  &:=
    \unityPowerTau{\sum_{k\in\modularOrbit{r,m,t}}\frac{k+\rho_\infty(r)}{m}}
    \prod_{k \in \modularOrbit{r,m,t}} \left[\sum_{n=0}^\infty a(mn+k) q^n\right]
  \\
  %
  \defineNotation[F-s-r-m-t]{F_{s, r, m, t}(\tau)}
  &:= \divisorprod{N} \eta(\delta\tau)^{s_\delta} \cdot P_{r,m,t}(\tau)
  \\
  &= \divisorprod{N} \eulerFunction{\delta}^{s_\delta}
    \cdot
    \unityPowerTau{\rho_\infty(s)}
    \cdot
    \unityPowerTau{\sum_{k\in\modularOrbit{r,m,t}}\frac{k+\rho_\infty(r)}{m}}
    \cdot
    \prod_{k \in \modularOrbit{r,m,t}} \left(\sum_{n=0}^\infty a(mn+k) q^n\right)
  \\
  &= \divisorprod{N} \eulerFunction{\delta}^{s_\delta}
    \cdot
    \unityPowerTau{
    \rho_\infty(s)
    +
    \sum_{k\in\modularOrbit{r,m,t}}\frac{k+\rho_\infty{r}}{m}
    }
    \cdot
    \prod_{k \in \modularOrbit{r,m,t}} \left(\sum_{n=0}^\infty a(mn+k) q^n\right)
  \\
  &= \divisorprod{N} \eulerFunction{\delta}^{s_\delta}
    \cdot
    % \unityPower{\tau
    q^\alpha
    \cdot
    \prod_{k \in \modularOrbit{r,m,t}} \left(\sum_{n=0}^\infty a(mn+k) q^n\right)
  \\
  \alpha
  &=
    \rho_\infty(s)
    +
    \sum_{k\in\modularOrbit{r,m,t}}\frac{k+\rho_\infty(r)}{m}
    \label{eq:alphaInfinity}
\end{align}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Transformation of orbit product $P_{r,m,t}$ under $\SL2Z$}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{align}
  \defineNotation[P-r-m-t-gamma-tau]{P_{r,m,t}(\gamma\tau)}
  &=
    \left(\frac{(c\tau+d)^{\divisorsum{M} \frac{r_\delta}{2}}}{m}\right)^\mu
    \prod_{k\in \modularOrbit{r,m,t}}
    \left[\sum_{\lambda=0}^{m-1}
    \unityPower{-\frac{\lambda}{24m}\Bigl(k+\rho_\infty(r)\Bigr)
    + \divisorsum{M}\frac{r_\delta(v_{\delta,m\lambda} +
    \kappa_{\gamma_{\delta,m,\lambda}})}{24}} \times\right.\notag\\
  &\qquad\times
    \left.
    \divisorprod{M}
    \left(\frac{h_{\delta,m,\lambda}}{\delta}\right)^{\!\frac{r_\delta}{2}}
    \cdot
    \unityPowerTau{\frac{\divisorsum{M} r_\delta u_{\delta,m,\lambda}}{24}}
    \cdot
    \divisorprod{M} \prod_{n=1}^\infty (1-q_{\delta,m,\lambda}^n)^{r_\delta}
    \right]
    \label{eq:P_r-m-t(gamma*tau)}
\end{align}

The parts of \eqref{eq:P_r-m-t(gamma*tau)} are implemented via
\textcolor{blue}{\code{SymbolicEtaQuotientOrbitProductGamma}}
(Section~\ref{sec:SymbolicEtaQuotientOrbitProductGamma}).


\begin{align}
  \defineNotation[F-s-r-m-t-gamma-tau]{F_{s,r,m,t}(\gamma\tau)}
  &:= \divisorprod{N} \eta(\delta\gamma\tau)^{s_\delta}
    \cdot
    P_{r, m, t}(\gamma\tau)
  \notag\\
  &=
  (c\tau+d)^{\divisorsum{N} \frac{s_\delta}{2}}
  \cdot
  \divisorprod{N}
  \left(\frac{h_\delta}{\delta}\right)^{\!\frac{s_\delta}{2}}
  \cdot
  \unityPower{\divisorsum{N} \frac{s_\delta(v_\delta + \kappa_\delta)}{24}}
  \cdot
  q^{\divisorsum{N} \frac{s_\delta u_\delta}{24}}
  \cdot
    \divisorprod{N} \prod_{n=1}^{\infty}(1-q_\delta^n)^{s_\delta} \times\notag\\
  &\qquad\times
    P_{r, m, t}(\gamma\tau)
  \notag\\
  &=
  \divisorprod{N}
  \left(\frac{h_\delta}{\delta}\right)^{\!\frac{s_\delta}{2}}
  \cdot
  \unityPower{\divisorsum{N} \frac{s_\delta(v_\delta + \kappa_\delta)}{24}}
  \cdot
  q^{\divisorsum{N} \frac{s_\delta u_\delta}{24}}
    \cdot
    \divisorprod{N} \prod_{n=1}^{\infty}(1-q_\delta^n)^{s_\delta} \times\notag\\
  &\qquad\times
    \frac{1}{m^\mu}
    \prod_{k\in \modularOrbit{r,m,t}}
    \left[\sum_{\lambda=0}^{m-1}
    \unityPower{-\frac{\lambda}{24m}\Bigl(k+\rho_\infty(r)\Bigr)
    + \divisorsum{M}\frac{s_\delta(v_{\delta,m\lambda} +
    \kappa_{\gamma_{\delta,m,\lambda}})}{24}} \times\right.\notag\\
  &\qquad\times
    \left.
    \divisorprod{M}
    \left(\frac{h_{\delta,m,\lambda}}{\delta}\right)^{\!\frac{r_\delta}{2}}
    \cdot
    \unityPowerTau{\frac{\divisorsum{M} r_\delta u_{\delta,m,\lambda}}{24}}
    \cdot
    \divisorprod{M} \prod_{n=1}^\infty (1-q_{\delta,m,\lambda}^n)^{r_\delta}
    \right]
    \label{eq:F_s-r-m-t(gamma*tau)}
\end{align}


The parts of \eqref{eq:F_s-r-m-t(gamma*tau)} are implemented via
\textcolor{blue}{\code{SymbolicModularGamma0EtaQuotientGamma}}
(Section~\ref{sec:SymbolicModularGamma0EtaQuotientGamma}).












%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{The formulas in short and their relations to the
  implementation}
\label{sec:formulas-in-short}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
$t \in \Set{0,1,\ldots,m-1}$

\begin{align*}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  f(\tau)
  &=
  \sum_{n=0}^\infty a(n) q^n
  =
  \divisorprod{M}\prod_{n=1}^\infty(1-q^{\delta n})^{r_\delta}
  =
  \divisorprod{M}\eulerFunction{\delta}^{r_\delta}
  =
  \unityPowerTau{-\frac{\sigmainfty[M]{r}}{24}} g_r(\tau)
  \\
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  f_t(\tau)
  &:=
  \sum_{n=0}^\infty a(n) q^{n-t}
  =
  \sum_{n=-t}^\infty a(n+t) q^{n}
  =
  \unityPowerTau{-t}f(\tau)
  =
  \unityPowerTau{-\frac{24t+\sigmainfty[M]{r}}{24}} g_r(\tau)
  \\
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  (U_mf_t)(\tau)
  &=
    \sum_{n=0}^\infty a(mn+t) q^n
  \\
  &=
  \frac{1}{m}
  \unityPowerTau{-\frac{24t+\sigmainfty[M]{r}}{24m}}
  \sum_{\lambda=0}^{m-1}
  \unityPower{-\frac{\lambda (24t+\sigmainfty[M]{r})}{24m}}
  \divisorprod{M}
    \eta\left(\frac{\delta(\tau+\lambda)}{m}\right)^{r_\delta}
  \\
  &=
    \frac{1}{m}
    \unityPowerTau{-\frac{24t+\sigmainfty[M]{r}}{24m}}
    \sum_{\lambda=0}^{m-1}
    \unityPower{-\frac{\lambda (24t+\sigmainfty[M]{r})}{24m}}
    g_{r,m,\lambda}(\tau)
\end{align*}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\textcolor{blue}{\texttt{SymbolicEtaQuotientLambdaGamma}}
(Section~\ref{sec:SymbolicEtaQuotientLambdaGamma})

\begin{align*}
  g_{r,m,\lambda}(\tau)
  &=
    \divisorprod{M}
    \eta\left(\frac{\delta(\tau+\lambda)}{m}\right)^{r_\delta}
  \\
  e &= \mathtt{etaQuotient}(M, \Delta, r, m, \lambda , \gamma)
  \\
  \mathtt{rationalPrefactor}(e)
  &=
    \divisorprod{M} \left(\frac{h_\delta}{\delta}\right)^{\!r_\delta}
  \\
  \mathtt{unityPower}(e)
  &=
    \divisorsum{M} \frac{r_\delta(v_{\delta,m,\lambda} +
                         \kappa_{\gamma_{\delta,m,\lambda}})}{24}
  \\
  \mathtt{qExponent}(e)
  &=
    \divisorsum{M} \frac{r_\delta u_{\delta,m,\lambda}}{24}.
\end{align*}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\textcolor{blue}{\texttt{SymbolicEtaQuotientGamma}}
(Section~\ref{sec:SymbolicEtaQuotientGamma})

\begin{align*}
  p_{r,m,t}(\tau)
  &=
    \unityPowerTau{\frac{(24t+\sigmainfty[M]{r}}{24m} } (U_mf_t)(\tau)
    =
    \frac{1}{m} \sum_{\lambda=0}^{m-1}
    \unityPower{-\frac{\lambda}{24m} (24t+\sigmainfty[M]{r})}
    g_{r,m,\lambda}(\tau)
  \\
  &=
    \unityPowerTau{\frac{24t+\sigmainfty[M]{r}}{24m}}
    \sum_{n=0}^\infty a(mn+t) q^n
\end{align*}



\begin{align*}
  e &= \mathtt{etaQuotient}(M, \Delta, r, m, t, \gamma)
  \\
  \mathtt{unityPower}(e)
  &=
    -\frac{\lambda}{24m}\Bigl(24t+\sigmainfty[M]{r}\Bigr) +
\end{align*}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\textcolor{blue}{\texttt{SymbolicEtaQuotientOrbitProductGamma}}
(Section~\ref{sec:SymbolicEtaQuotientOrbitProductGamma})

\begin{align*}
  P_{r, m, t}(\tau)
  &:=
    \prod_{k \in \modularOrbit{r,m,t}}
    p_{r,m,k}(\tau)
\end{align*}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\textcolor{blue}{\texttt{SymbolicModularGamma0EtaQuotientGamma}}
(Section~\ref{sec:SymbolicEtaQuotientOrbitProductGamma})

\begin{align*}
  F_{s, r, m, t}(\tau)
  &:=
    \divisorprod{N} \eta(\delta \tau)^{s_\delta} \cdot P_{r, m, t}(\tau)
\end{align*}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%




























%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
 \subsection{The trace and the Atkin-Lehner involution applied to
   $g_r$}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

See, for example, \cite{Kohnen_WeierstrassPointsAtInfinity_2004}.

We only treat the special case where $m=2$ and $N=121$.

Then
\begin{align*}
  W = W_2^{242}
  &=
    \begin{pmatrix}
      2 & 0\\
      242 & 1
    \end{pmatrix}\\
    %
  \gamma_{2,0}
  &=
    \begin{pmatrix}
      2 & 0\\
      242 & 1
    \end{pmatrix}
    \begin{pmatrix}
      1 & 0\\
      0 & 2
    \end{pmatrix}
  =
    \begin{pmatrix}2&0\\242&2\end{pmatrix}
  =
    \begin{pmatrix}1&0\\121&1\end{pmatrix}
    \begin{pmatrix}2&0\\0&2\end{pmatrix}
  \\
  \gamma_{2,1}
  &=
    \begin{pmatrix}
      2 & 0\\
      242 & 1
    \end{pmatrix}
    \begin{pmatrix}
      1 & 1\\
      0 & 2
    \end{pmatrix}
  =
    \begin{pmatrix}2&2\\242&244\end{pmatrix}
  =
    \begin{pmatrix}1&1\\121&122\end{pmatrix}
    \begin{pmatrix}2&0\\0&2\end{pmatrix}
\end{align*}

Since $\left(\begin{smallmatrix}2&0\\0&2\end{smallmatrix}\right)\tau =
\tau$, we can simply ignore this matrix and write
\begin{align*}
  (U_2 g_{r, W})(\tau)
  &=
    \frac{1}{2}\left(g_r(\gamma'_{2,0}\tau) + g_r(\gamma'_{2,1}\tau)\right)
\end{align*}
for
$\gamma'_{2,0} =
\left(\begin{smallmatrix}1&0\\121&1\end{smallmatrix}\right)$ and
$\gamma'_{2,0} =
\left(\begin{smallmatrix}1&1\\121&122\end{smallmatrix}\right)$.

Since 2 is a prime, we get from
\cite{Kohnen_WeierstrassPointsAtInfinity_2004} that
$\trace_{121}^{242}: M^\infty(242) \to M^\infty(121)$ can be computed via
\begin{gather*}
  g_r|\trace_{121}^{242}
  = g_r + 2 U_2(g_r|W_2^{242})
  = g_r + g_r|\gamma'_{2,0} + g_r|\gamma'_{2,1}.
\end{gather*}
Note that the width of $\gamma'_{2,0}$ and $\gamma'_{2,1}$ is 2, so in
our formula \eqref{eq:modular-g_r(gamma*tau)} we have
$x=q^{\frac{1}{2}}$.

Indeed the identity matrix, $\gamma'_{2,0}$, and $\gamma'_{2,1}$ are
three coset representative for
$\Gamma_0(242) \backslash \Gamma_0(121)$.
%
See function \code{rightCosetRepresentatives} in
\PathName{qetaauxmeq.spad} and \cite[Lemma~2.44]{Radu_PhD_2010}.































%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Generalized eta-functions}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Jacobi triple product}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{Definition}[Jacobi triple product]
  \label{def:Jacobi-triple-product}
\begin{align}
  \defineNotation[J-z-q]{\jacobiFunction{z}{q}}
  &:=
    \prod_{n=1}^\infty (1-z q^{n-1}) (1-z^{-1}q^n) (1-q^n)
    =
    \qPochhammer{z}{q} \qPochhammer{z^{-1}q}{q} \eulerFunction{}
    =
    \sum_{n=-\infty}^\infty (-1)^n z^n q^{\binom{n}{2}}
\end{align}
\end{Definition}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Let us assume that $0 \le g \le \delta$.
If we substitute $q \gets q^\delta$, $z \gets z q^g$, then we have
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{align*}
  \jacobiFunction{zq^g}{q^\delta}
  &=
  \prod_{n=1}^\infty
    (1-zq^{\delta (n-1)+g})
    (1-z^{-1}q^{\delta n-g})
    (1-q^{\delta n})
  \\
  &=
    \qPochhammer{zq^g}{q^\delta} \qPochhammer{z^{-1}q^{\delta-g}}{q^\delta}
    \eulerFunction{\delta}
  \\
  &=
    \sum_{n=-\infty}^\infty (-1)^nz^nq^{gn + \delta \binom{n}{2}}.
\end{align*}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

For $g=0$, we substitute $q \gets q^\delta$ and split the sum. Then we have
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{align}
  \jacobiFunction{z}{q^\delta}
  &=
  \prod_{n=1}^\infty
    (1-zq^{\delta (n-1)})
    (1-z^{-1}q^{\delta n})
    (1-q^{\delta n})
  =
    \qPochhammer{z}{q^\delta} \qPochhammer{z^{-1}q^{\delta}}{q^\delta}
    \eulerFunction{\delta}
  \notag\\
  &=
    \sum_{n=-\infty}^\infty (-1)^nz^nq^{\delta \binom{n}{2}}
    =
    \sum_{n=1}^\infty (-1)^nz^nq^{\delta n(n-1)/2}
    +
    \sum_{n=0}^\infty (-1)^nz^{-n}q^{\delta n(n+1)/2}
  \notag\\
  &=
    \sum_{n=0}^\infty (-1)^{n+1}z^{n+1}q^{\delta n(n+1)/2}
    +
    \sum_{n=0}^\infty (-1)^nz^{-n}q^{\delta n(n+1)/2}
  \notag\\
  &=
    \sum_{n=0}^\infty (-1)^n(z^{-n}-z^{n+1})q^{\delta n(n+1)/2}
  \\
  &=
    \sum_{n=0}^\infty (z^{-2n}-z^{2n+1})q^{\delta (2n+1) n}
                   -(z^{-(2n+1)}-z^{2n+2})q^{\delta (2n+1) (n+1)}.
  \label{eq:Jacobi-g=0}
\end{align}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

For $2g=\delta$, we substitute $q \gets q^{2g}$, $z \gets z q^g$ and
split the sum. Then we have
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{align}
  \jacobiFunction{zq^g}{q^{2g}}
  &=
  \prod_{n=1}^\infty
    (1-zq^{g(2n-1)})
    (1-z^{-1}q^{g(2n-1)})
    (1-q^{2 g n})
  \notag\\
  &=
    \qPochhammer{zq^g}{q^{2g}} \qPochhammer{z^{-1}q^g}{q^{2g}}
    \eulerFunction{2g}
  \notag\\
  &=
    \sum_{n=-\infty}^\infty (-1)^nz^nq^{gn + 2g n (n-1)/2}.
  \notag\\
  &=
    \sum_{n=-\infty}^\infty (-1)^nz^nq^{gn^2}.
  \\
  &=
    1 + \sum_{n=1}^\infty (-1)^n(z^n + z^{-n})q^{gn^2}.
  \label{eq:Jacobi-2g=delta}
\end{align}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


Clearly we have
\begin{align}
  \jacobiFunction{zq^g}{q^\delta}
  &=
  \jacobiFunction{z^{-1}q^{\delta-g}}{q^\delta}.
  \label{eq:Jacobi-g-delta-g}
\end{align}

Let us assume that $0 < g < \lfloor \frac{\delta}{2}\rfloor$.
If we substitute $q \gets q^\delta$, $z \gets z q^g$.

Let us combine the positive and negative $n$ and do the summation of
$n-1=2k-1$ and $n=2k$ in one step.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{align}
  \jacobiFunction{zq^g}{q^\delta}
  &=
    1 + \sum_{n=1}^\infty (-1)^n \left[
    z^n q^{\frac{n}{2}(\delta (n-1) + 2 g)}
    +
    z^{-n} q^{\frac{n}{2}(\delta (n+1) - 2 g)}
    \right]
  \\
  \begin{split}
  &=
    1 + \sum_{k=1}^\infty
    \left\{
    -\left[
    z^{2k-1}
    q^{\frac{(2k-1)}{2}(\delta ((2k-1)-1) + 2 g)}
    +
    z^{-2k+1}
    q^{\frac{(2k-1)}{2}(\delta ((2k-1)+1) - 2 g)}
    \right]
    \right.
  \notag\\
  &\qquad\qquad\quad
    +
    \left.
    \left[
    z^{2k}
    q^{\frac{(2k)}{2}(\delta ((2k)-1) + 2 g)}
    +
    z^{-2k}
    q^{\frac{(2k)}{2}(\delta ((2k)+1) - 2 g)}
    \right]
  \right\}
  \end{split}
  \notag\\
  \begin{split}
  &=
    1 + \sum_{k=1}^\infty
    \left\{
    -
    z^{2k-1}
    q^{(2k-1)(\delta (k-1) + g)}
    -
    z^{-2k+1}
    q^{(2k-1)(\delta k - g)}
    \right.
  \notag\\
  &\qquad\qquad\quad
    +
    \left.
    z^{2k}
    q^{k (\delta (2k-1) + 2 g)}
    +
    z^{-2k}
    q^{k (\delta (2k+1) - 2 g)}
  \right\}
  \end{split}
  \notag\\
  \begin{split}
  &=
    1 + \sum_{k=1}^\infty
    q^{(2k-1)(\delta (k-1) + g)}
    \left\{
    -
    z^{2k-1}
    -
    z^{-2k+1}
    q^{(2 k - 1) (\delta -2\, g)}
    \right.
    \notag\\
    &\qquad\qquad\quad
    +
    \left.
    z^{2k}
    q^{(2 k - 1) \delta + g}
    +
    z^{-2k}
    q^{(4k-1) (\delta - g)}
  \right\}
  \end{split}
  \notag\\
  \begin{split}
  &=
    1 + \sum_{n=0}^\infty
    q^{(2n+1)(\delta n + g)}
    \left\{
    -
    z^{2n+1}
    -
    z^{-(2n+1)}
    q^{(2n+1) (\delta -2\, g)}
    \right.
    \notag\\
    &\qquad\qquad\quad
    +
    \left.
    z^{2n+2}
    q^{(2 n + 1) \delta + g}
    +
    z^{-2n-2}
    q^{(4n+3) (\delta - g)}
  \right\}
  \end{split}
\end{align}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

The function $\jacobiFunction{z q^g}{q^\delta}$ is implemented in
\PathName{src/qfunct.spad} as \code{jacobiFunction(f,delta,g)} where
$f: \setZ \to R$ is a function that computes $z^n$ in the coefficient
ring $R$.

Let us substitute above $\delta \gets g + g'$, \ie, $g'=\delta-g$.
Then we have:
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{align}
  \jacobiFunction{zq^g}{q^{g+g'}}
   &=
    1 + \sum_{n=1}^\infty (-1)^n \left[
    z^n q^{\frac{n}{2}((g+g') (n-1) + 2 g)}
    +
    z^{-n} q^{\frac{n}{2}((g+g') (n+1) - 2 g)}
    \right]
  \notag\\
  \begin{split}
  &=
    1 + \sum_{k=1}^\infty
    \left\{
    -
    z^{2k-1}
    q^{(2k-1)((g k + g' (k-1))}
    -
    z^{-2k+1}
    q^{(2k-1)(g (k-1) + g' k)}
    \right.
  \notag\\
  &\qquad\qquad\quad
    +
    \left.
    z^{2k}
    q^{k ((g (2k+1) + g' (2k-1))}
    +
    z^{-2k}
    q^{k (g (2k-1) +g' (2k+1))}
  \right\}
  \end{split}
  \notag\\
  \begin{split}
  &=
    1 + \sum_{n=0}^\infty
    \left\{
    -
    z^{2 n + 1}
    q^{(2 n + 1) ((g (n+1) + g' n))}
    -
    z^{-2n-1}
    q^{(2 n + 1) (g n + g' (n+1))}
    \right.
  \\
  &\qquad\qquad\quad
    +
    \left.
    z^{2(n+1)}
    q^{(n+1) ((g (2 n + 3) + g' (2 n + 1))}
    +
    z^{-2 (n + 1)}
    q^{k (g (2 n + 1) + g' (2 n + 3))}
  \right\}
  \end{split}
  \label{eq:Jacobi-g-g'}
\end{align}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%











%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Generalized eta-function $\eta_{g,h}^{[S]}$ (Schoeneberg)}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{Hemmecke}
  The transformation rules for the generalized eta-function are
  usually given in terms of their notation by Schoeneberg, see
  \cite[Chp.~VIII]{Schoeneberg_EllipticModularFunctions_1974} and
  \cite{ChenDuZhao_FindingModularFunctionsRamanujan_2019}. For our
  purpose we add additional indices $h$ and $N$ to refer to the
  implicit parameters used by Schoeneberg. We also add an upper index
  $[S]$ to refer to Schoeneberg's definition.
\end{Hemmecke}

In the following we always use $q = e^{2\pi i \tau}$ for $\tau \in
\setH$.
%
Let $N \in \setN$ and $\zeta_N$ be a primitive $N$-th root of unity.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{Definition}
  (\cite{Schoeneberg_EllipticModularFunctions_1974},
  \cite[p.~672]{Yang_GeneralizedDedekindEtaFunctions_2004})
  Let $g$ and $h$ be
  real numbers, then the generalized eta-function $\eta_{g,h}^{[S]}$
  is defined by
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{align}
  \defineNotation[eta-g-h-tau-Schoeneberg]{\eta_{g,h}^{[S]}(\tau)}
  &:=
  \alpha(g,h,N) q^{\frac{1}{2} P_2(\frac{g}{N})}
  \prod_{\substack{n>0\\n\equiv g \bmod N}}
       (1-\zeta_N^h q^{n/N})
  \prod_{\substack{n>0\\n\equiv -g \bmod N}}
       (1-\zeta_N^{-h} q^{n/N})
  \label{eq:def:eta_g-h^[S](tau)}
\end{align}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
where
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{gather}
  \defineNotation[alpha-g-h-N]{\alpha(g,h,N)}
  :=
  \begin{cases}
    (1 - \zeta_N^{-h}) \unityPower{\frac{1}{2} P_1\!\left(\frac{h}{N}\right)},
    &
    \text{if $g\equiv_N 0$ and $h\not\equiv_N 0$,}
    \\
    1, & \text{otherwise},
  \end{cases}
  \label{eq:eta_g-h^[S](tau)-prefactor}
\end{gather}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
and $P_1(x)$ is the first Bernoulli function given by
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{gather*}
  \defineNotation[P-1]{P_1(x)}
  =
  \{x\} - \frac{1}{2}.
\end{gather*}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

In case $g\equiv_N 0$ and $h\not\equiv_N 0$ we have
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{align*}
  \eta_{g,h}^{[S]}(\tau)
  &=
  \unityPower{\frac{1}{2}
    P_1\!\left(\frac{h}{N}\right)}
    q^{\frac{1}{2} P_2(\frac{g}{N})}
  \prod_{n=1}^\infty
    \bigl(1-\zeta_N^h q^n\bigr)
  \prod_{n=0}^\infty
    \bigl(1-\zeta_N^{-h} q^n\bigr)
  \notag\\
  &=
  \unityPower{\frac{1}{2}
    P_1\!\left(\frac{h}{N}\right)}
    q^{\frac{1}{2} P_2(\frac{g}{N})}
  \qPochhammer{\zeta_N^h q}{q}
  \qPochhammer{\zeta_N^{-h}}{q}
  \notag\\
  &=
  \unityPower{\frac{1}{2}
    P_1\!\left(\frac{h}{N}\right)}
    q^{\frac{1}{2} P_2(\frac{g}{N})}
    \jacobiFunction{\zeta_N^{-h}}{q} \eulerFunction{}^{-1}
\end{align*}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%




If $g\not\equiv_N 0$ or $h\equiv_N 0$, then $\alpha(g,h,N)=1$ and thus
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{align*}
  \eta_{g,h}^{[S]}(\tau)
  &=
  q^{\frac{1}{2} P_2(\frac{g}{N})}
  \prod_{n=1}^\infty
    \bigl(1-\zeta_N^h q^{n-1 + \left\{\frac{g}{N}\right\}}\bigr)
    \bigl(1-\zeta_N^{-h} q^{n - \left\{\frac{g}{N}\right\}}\bigr)
  \notag\\
  &=
  q^{\frac{1}{2} P_2(\frac{g}{N})}
  \qPochhammer{\zeta_N^h q^{\left\{\frac{g}{N}\right\}}}{q}
  \qPochhammer{\zeta_N^{-h} q^{1-\left\{\frac{g}{N}\right\}}}{q}
  \notag\\
  &=
  q^{\frac{1}{2} P_2(\frac{g}{N})}
    \jacobiFunction{\zeta_N^h q^{\left\{\frac{g}{N}\right\}}}{q}
    \eulerFunction{}^{-1}
\end{align*}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
where $0\le\left\{\frac{g}{N}\right\}<N$ is the fractional part of
$\frac{g}{N}$.


If we define
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{align}
  \defineNotation[Jacobi-a-b-q]{\jacobiAlpha{a}{b}{q}}
  &=
    \begin{cases}
      \unityPower{\frac{1}{2} P_1(b)}
      \jacobiFunction{\unityPower{\left\{-b\right\}}}{q} & \text{if $a\in\setZ$ and
        $b\not\in\setZ$},
      \\
      \jacobiFunction{\unityPower{\left\{b\right\}}q^{\{a\}}}{q} & \text{otherwise.}
    \end{cases}
  \label{eq:Jacobi_a-b-q}
\end{align}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
then we can combine the above cases and write
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{align}
  \defineNotation[eta-g-h-tau-Schoeneberg]{\eta_{g,h}^{[S]}(\tau)}
  &=
  q^{\frac{1}{2} P_2(\frac{g}{N})}
    \jacobiAlpha{\frac{g}{N}}{\frac{h}{N}}{q}
    \eulerFunction{}^{-1}
  \label{eq:eta_g-h^[S](tau)}
\end{align}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%








Since there is an implicit parameter $N$, we sometimes add an explicit
third index $N$, \ie
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{align}
  \label{eq:eta_g-h-N^[S](tau)}
  \defineNotation[eta-g-h-N-tau-Schoeneberg]{\eta_{g,h,N}^{[S]}(\tau)}
  &=
  \eta_{g,h}^{[S]}(\tau),
\end{align}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
in order to make this parameter explicit.
\end{Definition}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Obviously, $\eta_{g,h}^{[S]}(\tau) = \eta_{g+uN,h+vN}^{[S]}(\tau)$ for
any integers $u$ and $v$.






%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Theta function $\theta_{\delta,g}$ (Koornwinder)}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

The following function is connected to a 3-term Weierstrass identity
(2.7) in \cite{Koornwinder_ThetaIdentities_2014}.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{Definition}
  \cite[special case of equation (2.1)]{Koornwinder_ThetaIdentities_2014}.
  Let $\delta$ be a positive natural number and $0 < g < \delta$ be a
  residue class (mod $\delta$).
  %
  We define the function $\theta_{\delta,g}$ as follows.
  \begin{align}
    \defineNotation[theta-delta-g-tau]{\theta_{\delta,g}(\tau)}
    &:=
      \qPochhammer{q^g}{q^\delta} \qPochhammer{q^{\delta-g}}{q^\delta}
      =
      \jacobiFunction{q^g}{q^\delta} \eulerFunction{\delta}^{-1}
      \label{eq:theta_delta-g(tau)}
  \end{align}
  where $q=2 \pi i \tau$.
\end{Definition}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

The following Lemma can also be found in Equations (2.4) and (2.5) of
\cite{Koornwinder_ThetaIdentities_2014}.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{Lemma}
  Let $\delta$ be a positive natural number and $0 < g < \delta$ be a
  residue class (mod $\delta$).
  \begin{gather}
    \theta_{\delta,g+\delta}(q)
      =
      \theta_{\delta,-g}(q)
      =
      -q^{-g} \, \theta_{\delta,g}(q).
      \label{eq:theta_delta-g}
  \end{gather}
\end{Lemma}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{proof}
  Clearly,
  \begin{align*}
    \theta_{\delta,-g}(q)
    &=
      \qPochhammer{q^{-g}}{q^\delta} \qPochhammer{q^{\delta+g}}{q^\delta}
      =
      \theta_{\delta,g+\delta}(q)
    \\
    &=
      \prod_{n=1}^\infty (1-q^{\delta (n-1)-g})(1-q^{\delta n + g})
    \\
    &=
      \frac{1-q^{-g}}{1-q^g}
      \prod_{n=1}^\infty (1-q^{\delta n - g})(1-q^{\delta (n-1) + g})
    \\
    &=
      -q^{-g} \, \theta_{\delta,g}(q).
  \end{align*}
\end{proof}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


For $x,y,u,v\in\setZ$, the Weierstrass addition Formula (2.7) from
\cite{Koornwinder_ThetaIdentities_2014} then reads (for simplicity we
do not write the argument):
\begin{gather}
  q^{y+u} \theta_{\delta,x+y} \theta_{\delta,x-y}
  \theta_{\delta,v+u} \theta_{\delta,v-u}
  +
  q^{u+v} \theta_{\delta,x+u} \theta_{\delta,x-u}
  \theta_{\delta,y+v} \theta_{\delta,y-v}
  +
  q^{v+y} \theta_{\delta,x+v} \theta_{\delta,x-v}
  \theta_{\delta,u+y} \theta_{\delta,u-y}
  =
  0
\end{gather}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Generalized eta-function $E_{g,h}^{[Y]}$ (Yang)}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
Yet another definition is given by
\cite{Yang_GeneralizedDedekindEtaFunctions_2004}.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{Definition}
  \cite{Yang_GeneralizedDedekindEtaFunctions_2004}
  %
  Let $g$ and $h$ be real numbers not simultaneously congruent to 0
  modulo $N$.
%
The generalized Dedekind eta-function is given by
\begin{align}
  \defineNotation[E-g-h-tau]{E_{g,h}(\tau)}
  &:=
  \defineNotation[eta-g-h-tau-Yang]{\eta_{g,h}^{[Y]}(\tau)}
  :=
  q^{\frac{1}{2} B(\frac{g}{N})}
  \prod_{n=1}^\infty
    \bigl(1-\zeta_N^h q^{n-1 + \frac{g}{N}}\bigr)
    \bigl(1-\zeta_N^{-h} q^{n - \frac{g}{N}}\bigr)
  \notag\\
  &=
  q^{\frac{1}{2} B(\frac{g}{N})}
    \qPochhammer{\zeta_N^h q^{\frac{g}{N}}}{q}
    \qPochhammer{\zeta_N^{-h} q^{1-\frac{g}{N}}}{q}
  \label{eq:eta_g-h^[Y](tau)}
\end{align}
For $g \not\equiv_N 0$ define
\begin{align}
  \defineNotation[E-g-tau]{E_g(\tau)}
  &:=
  \defineNotation[eta-g-tau-Yang]{\eta_g^{[Y]}(\tau)}
  :=
  E_{g,0}(N \tau)
  =
  q^{\frac{N}{2} B(\frac{g}{N})}
  \prod_{n=1}^\infty
    \bigl(1-q^{N (n-1) + g}\bigr)
    \bigl(1-q^{N n - g}\bigr).
  \notag\\
  &=
  q^{\frac{N}{2} B(\frac{g}{N})}
    \qPochhammer{q^g}{q^N}
    \qPochhammer{q^{N-g}}{q^N}
  =
  q^{\frac{N}{2} B(\frac{g}{N})}
  \jacobiFunction{q^g}{q^N} \eulerFunction{N}^{-1}
  \label{eq:eta_g^[Y](tau)}
\end{align}
\end{Definition}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{Lemma}
  Let $k\in\setN$ be such that $N=k \delta$. Furthermore, let $g$ be a
  natural number with $0 < g < \delta$, and let $h$ be an arbitrary
  real number. Then the following holds.
  \begin{align*}
    E_{g,h}(\tau) &= \eta_{g,h}^{[S]}(\tau)
    \\
    %
    E_g(\tau)
    &=
      E_{g,0}(N \tau)
      =
      \eta_{g,0}^{[S]}(N \tau)
      =
      \eta_{N,g}(\tau)
    \\
    %
    \eta_{\delta,g}(\tau)
    &=
    \prod_{i=0}^{k-1} E_{\delta i + g}(\tau)
  \end{align*}
\end{Lemma}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{proof}
  The first two lines are obvious from the definition.
  %
  The last one follows from
  \begin{gather*}
    \prod_{m=1}^\infty \bigl(1-q^{\delta m + g}\bigr) =
    % \prod_{\substack{n>0,0\le i<k\\m=kn+i}} \bigl(1-q^{\delta m+g}\bigr) =
    \prod_{n=1}^\infty \prod_{i=0}^{k-1} \bigl(1-q^{\delta (k n + i) + g}\bigr) =
    \prod_{i=0}^{k-1} \prod_{n=1}^\infty \bigl(1-q^{N n + \delta i + g}\bigr)
  \end{gather*}
  and
  \begin{gather*}
    \delta P_2\left(\frac{g}{\delta}\right)
    =
    \sum_{i=0}^{k-1}N B\left(\frac{\delta i + g}{N}\right).
  \end{gather*}
  Note that $0<g<\delta \le N$ and $B(x)=P_2(x)$ for $0<x<1$.
\end{proof}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

The following Lemma is extracted from Theorem~1 and Corollary~2 of
\cite{Yang_GeneralizedDedekindEtaFunctions_2004} and says that we can
essentially restrict the indices to $0<g<N$ and $0\le h<N$.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{Lemma}[Yang]
  \label{thm:modular-Yang-E}
  Let $g$ and $h$ be real numbers not simultaneously congruent to 0
  modulo $N$. Then
  \begin{gather*}
    E_{g+N,h}(\tau) = E_{-g,-h}(\tau) = -\zeta_N^{-h} E_{g,h}(\tau)\\
    E_{g,h+N}(\tau) = E_{g, h}(\tau)
  \end{gather*}
  Let $g \not\equiv_N 0$. Then
  \begin{gather*}
    E_{g+N}(\tau) = E_{-g}(\tau) = - E_g(\tau)
  \end{gather*}
\end{Lemma}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

By simple comparison, we see that
\begin{gather}
  \eta_{g,h}^{[S]}(\tau)
  =
  \alpha(g,h,N) E_{g,h}(\tau)
  \label{eq:eta_g-h-Schoneberg-Yang}
\end{gather}
if $0<g<N$ and $0\le h<N$.







%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Transformation of $\eta_{g,h}^{[S]}$ under $\SL2Z$}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Furthermore, for $m, M, N\in\setN$, $\divides{\delta}{M}$,
$t \in \Set{0,\ldots,m-1}$,
$\gamma=\left(\begin{smallmatrix}a&b\\c&d\end{smallmatrix}\right)\in\SL2Z$,

Since $\eta_{\delta,0}(\tau) = \eta(\delta\tau)^2$ and we already have
a transformation formula for the pure eta-function given by
\eqref{eq:eta_delta(gamma*tau)}, we only need to consider
transformation rules with $g \not\equiv_\delta 0$.

A transformation formula was given in
\cite[Chp.~VIII]{Schoeneberg_EllipticModularFunctions_1974}, see
also \cite[p.~673]{Yang_GeneralizedDedekindEtaFunctions_2004}.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{Lemma}
  \label{thm:Generalized-Eta-Transformation-Schoeneberg}
  Let
  $\left(\begin{smallmatrix}a&b\\c&d\end{smallmatrix}\right) \in
  \SL2Z$, $N>0$ be an integer, and $g$, $h$ two real numbers not
  simultaneously congruent to 0 modulo $N$.
  %
  Then
  \begin{gather}
    \label{eq:eta_g-h-N^[S](gamma*tau)}
    \defineNotation[eta-g-h-N-gamma-tau-Schoeneberg]%
      {\eta_{g,h,N}^{[S]}(\gamma\tau)}
    =
    \unityPower{\kappa_{g,h,N,\gamma}^{[S]}} \, \eta_{g',h',N}^{[S]}(\tau)
  \end{gather}
  where $\unityPowerSymbol$ is defined in Definition~\ref{def:epsilon},
  \begin{gather}
    \defineNotation[kappa-g-h-N-gamma-Schoeneberg]{\kappa_{g,h,N,\gamma}^{[S]}}
    =
    \begin{cases}
      \frac{b}{2d} P_2(\frac{g}{N}), &\text{if $c=0$},
      \\
      \frac{a}{2c} P_2(\frac{g}{N})
        + \frac{d}{2c} P_2(\frac{g'}{N})
        - \sign c \cdot s_{g,h,N}(a,c),
      &
      \text{if $c\not=0$},
    \end{cases}
    \label{eq:kappa_g-h-N-gamma-Schoeneberg}
  \end{gather}
  $g'=ag+ch$, $h'=bg+dh$, and $s_{g,h,N}(a,c)$ is the
  \emph{generalized Dedekind sum} defined by
  \begin{gather}
    \defineNotation[s-g-h-N]{s_{g,h,N}}(a,c)
    =
    \sum_{k \bmod c}
    \Bigl(\Bigl( \frac{g + k N}{c N} \Bigr)\Bigr)
    \Bigl(\Bigl( \frac{g' + k a N}{c N} \Bigr)\Bigr),
    \label{eq:s_g-h-N}
  \end{gather}
  where the summation runs over a complete set of representatives mod
  $c$ and
  \begin{gather*}
    \defineNotation[x-P1-0]{((x))}
    =
    \begin{cases}
      P_1(x) & \text{if $x\notin\setZ$},
      \\
      0, & \text{if $x \in \setZ$},
    \end{cases}
  \end{gather*}
  see \cite[p.~673]{Yang_GeneralizedDedekindEtaFunctions_2004}.
\end{Lemma}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Note that because in \eqref{eq:s_g-h-N} the sum runs over all
representatives mod $c$, we have
\begin{gather*}
  s_{g,h,N}(a,c)=s_{g+N,h,N}(a,c)=s_{g,h+N,N}(a,c).
\end{gather*}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Transformation of $E_{g,h}^{[Y]}$ under $\SL2Z$}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{Lemma}[Yang]
  \cite[Theorem~1]{Yang_GeneralizedDedekindEtaFunctions_2004}.
  \label{thm:Generalized-Eta-Transformation-Yang}
  Let
  $\left(\begin{smallmatrix}a&b\\c&d\end{smallmatrix}\right) \in
  \SL2Z$, $N>0$ be an integer, and $g$, $h$ two real numbers not
  simultaneously congruent to 0 modulo $N$.
  %
  Then
  \begin{gather*}
    E_{g,h}(\gamma\tau)
    =
    \unityPower{\kappa_{g,h,N,\gamma}^{[Y]}}E_{g',h'}(\tau),
  \end{gather*}
  where $g'=ag+ch$, $h'=bg+dh$, and
  \begin{gather}
    \defineNotation[kappa-g-h-N-gamma-Yang]{\kappa_{g,h,N,\gamma}^{[Y]}}
    =
    \begin{cases}
      \frac{b}{2d} B(\frac{g}{N}), &\text{if $c=0$},
      \\
      \frac{c (a+d-3) + b d (1 - c^2)}{12} + \frac{\mu}{2}
      &
      \text{if $c$ is odd}
      \\
      \frac{a c (1 - d^2) + d (b - c + 3)}{12} + \frac{\mu}{2} - \frac{1}{4}
      &
      \text{if $c\not=0$ and $d$ is odd}
    \end{cases}
    \label{eq:kappa_g-h-N-gamma-Yang}
  \end{gather}
  for
  \begin{gather}
    \mu = \frac{g^2 a b + 2 g h b c + h^2 c d}{N^2}
             - \frac{g b + h (d-1)}{N}.
  \end{gather}
\end{Lemma}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Clearly, according to Lemma~\ref{thm:modular-Yang-E}, for some integer
$z$ it must hold:
\begin{gather*}
  \kappa_{g,h,N,\gamma}^{[S]}
  =
  z + \kappa_{g,h,N,\gamma}^{[Y]}
    + \left\lfloor\frac{g'}{N} \right\rfloor
      \left(\frac{1}{2} - \frac{h'}{N}\right)
\end{gather*}
if $g\not\equiv_N 0$ and $g'\not\equiv_N 0$.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{The function $\eta_{\delta,g,m,\lambda}$ and its
  transformation under $\SL2Z$}
\label{sec:[eta-delta-g-m-lambda-gamma-tau-Robins}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Let us first find an expression for the transformation of
$\eta_{\delta,g}(\gamma\tau)$ which is implemented through the domain
\code{SymbolicGeneralizedEtaGamma}.

Since $\eta_{\delta,g}=\eta_{\delta,g,1,0}$, we only expand here the
more general case.

Note that in our context we have $0 < g < \delta$ and
$\gcd(a', b')=1$. Thus, $a'g$ and $b'g$ cannot be zero modulo $\delta$
at the same time.
Depending on whether or not $\frac{a' g}{\delta}\in\setZ$ we
distinguishe two cases similar to \eqref{eq:eta_g-h^[S](tau)-prefactor}.

With $W$, $\gamma_{\delta,m,\lambda}$, and $\tau_{\delta,m,\lambda}$
defined as in in \eqref{eq:W_delta-m-lambda},
\eqref{eq:gamma_delta-m-lambda}, and \eqref{eq:tau_delta-m-lambda},
respectively, we define:

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{align}
  \defineNotation[eta-delta-g-m-lambda-gamma-tau-Robins]
    {\eta_{\delta,g,m,\lambda}(\gamma\tau)}
  &=
    \eta_{g,0,\delta}^{[S]}(W\tau)
%  \notag\\
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%  &
  =
    \eta_{g,0,\delta}^{[S]}(\gamma_{\delta,m,\lambda}\tau_{\delta,m,\lambda})
%  \notag\\
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%  &
   =
    \unityPower{\kappa_{g,0,\delta,\gamma_{\delta,m,\lambda}}^{[S]}}\,
    \eta_{a' g, b' g,\delta}^{[S]}(\tau_{\delta,m,\lambda})
  \notag\\
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  &\eqby{eq:eta_g-h^[S](tau)}
    \unityPower{\kappa_{g,0,\delta,\gamma_{\delta,m,\lambda}}^{[S]}}
  q^{\frac{1}{2} P_2
    \left(\frac{a'g}{\delta}\right)}
    \jacobiAlpha{\frac{a' g}{\delta}}{\frac{h' g}{\delta}}{q_{\delta,m,\lambda}}
    \eulerFunction[q_{\delta,m,\lambda}]{}^{-1}
    \notag\\
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  \begin{split}
    &=
    \unityPower{
      \kappa_{g,0,\delta,\gamma_{\delta,m,\lambda}}^{[S]}
      +
      \frac{v_{\delta,m,\lambda}}{2} P_2\left(\frac{a' g}{\delta}\right)
    }
    \cdot
    \unityPowerTau{
      \frac{u_{\delta,m,\lambda}}{2} P_2\left(\frac{a' g}{\delta}\right)}
    \cdot
    \\
    &\qquad\qquad
    \cdot
    \jacobiAlpha{\frac{a' g}{\delta}}{\frac{h' g}{\delta}}{q_{\delta,m,\lambda}}
    \eulerFunction[q_{\delta,m,\lambda}]{}^{-1}
  \end{split}
  \label{eq:eta_delta-g-m-lambda^[R](gamma*tau)}
\end{align}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%







The parts of \eqref{eq:eta_delta-g-m-lambda^[R](gamma*tau)} are
implemented via \textcolor{blue}{\code{SymbolicGeneralizedEtaGamma}}
(Section~\ref{sec:SymbolicGeneralizedEtaGamma}).
\\
If \code{e = generalizedEta(delta, g, m, lambda, gamma)}, then we have the
following correspondence.
\begin{align*}
  \text{\code{gamma1(e) : SL2Z}}
  &=
    \gamma_{\delta,m,\lambda} = \begin{pmatrix}a'&b'\\c'&d'\end{pmatrix}
  \\
  \text{\code{gamma2(e) : MZ}}
  &=
    \begin{pmatrix}a''&b''\\0&d''\end{pmatrix}
  \\
  \text{\code{kappaSchoeneberg(e) : Q}}
  &=
    \kappa_{g,0,\delta,\gamma_{\delta,m,\lambda}}
  \\
  \text{\code{udelta(e) : Q}}
  &=
    u_{\delta,m,\lambda} = \frac{a''}{d''}
  \\
  \text{\code{vdelta(e) : Q}}
  &=
    v_{\delta,m,\lambda} = \frac{b''}{d''}
  \\
  \text{\code{unityExponent(e) : Q}}
  &=
    \kappa_{g,0,\delta,\gamma_{\delta,m,\lambda}}^{[S]}
    +
    \frac{v_{\delta,m,\lambda}}{2} P_2\left(\frac{a' g}{\delta}\right)
  \\
  \text{\code{qExponenbt(e) : Q}}
  &=
    \frac{u_{\delta,m,\lambda}}{2} P_2\left(\frac{a' g}{\delta}\right)
\end{align*}















Compare \eqref{eq:generalized-sigmaInfinity} and
\eqref{eq:generalized-sigma0} with the implementation of
\code{sigmaInfinity} and \code{sigma0} in \code{QEtaAuxiliaryPackage}
as well as \code{conditionSigma0?} in \code{QEtaCofactorSpace}.



Note that \code{matrixEtaOrder} is the collection of coefficients of
the $r_{\delta,g}$ in Theorem~\ref{thm:matrixEtaOrderRobins} for the
in \eqref{eq:order-rbar-non-adjusted} with an adjustment for $N=4$ so
that we get the order of the expansion in $w_\gamma$, see
\eqref{eq:width1}.




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Transformation $g_{\bar{r},m,\lambda}$ under $\SL2Z$}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Let us take a generalized eta-quotient $g_{\bar{r}}$ of the form
\eqref{eq:g_rbar(tau)}.
Similar to what has been done above for pure eta-quotients, we first
need the transformation of
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{align}
  \defineNotation[g-rtilde-m-lambda-tau]{g_{\tilde{r},m,\lambda}(\tau)}
  &:=
  g_{\tilde{r}}
    \left(
    \begin{pmatrix}1&\lambda\\0&m\end{pmatrix}\tau
    \right)
  \label{eq:g_rtilde-m-lambda(tau)}
\end{align}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
and then get with \eqref{eq:g_r-m-lambda(gamma*tau)} a transformation
formula for
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{align}
  \defineNotation[g-rbar-m-lambda-tau]{g_{\bar{r},m,\lambda}(\tau)}
  &:=
    g_{r,m,\lambda}(\tau)
    \cdot
    g_{\tilde{r},m,\lambda}(\tau).
  \label{eq:g_rbar-m-lambda(tau)}
\end{align}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



With $W$, $\gamma_{\delta,m,\lambda}$, and $\tau_{\delta,m,\lambda}$
defined as in in \eqref{eq:W_delta-m-lambda},
\eqref{eq:gamma_delta-m-lambda}, and \eqref{eq:tau_delta-m-lambda},
respectively, and the transformation formula
\eqref{eq:eta_delta-g-m-lambda^[R](gamma*tau)}, we have the following
formula.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{align}
  \defineNotation[g-rtilde-gamma-m-lambda-tau]{g_{\tilde{r},m,\lambda}(\gamma\tau)}
  &=
    \genprod[M]
    \eta_{\delta,g,m,\lambda}(\gamma\tau)^{r_{\delta,g}}
  \notag\\
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  \begin{split}
  &=
    \unityPower{
      \gensum[M]
      r_{\delta,g}
      \left(
      \kappa_{g,0,\delta,\gamma_{\delta,m,\lambda}}^{[S]}
      +
      \frac{v_{\delta,m,\lambda}}{2} P_2\left(\frac{a' g}{\delta}\right)
      \right)}
  \cdot
  \unityPowerTau{
    \gensum[M]
    \frac{r_{\delta,g} u_{\delta,m,\lambda}}{2} P_2\left(\frac{a' g}{\delta}\right)}
  \times
  \\
  &\qquad\qquad
  \times
  \genprod[M]
  \left(
    \jacobiAlpha{\frac{a' g}{\delta}}{\frac{b' g}{\delta}}{q_{\delta,m,\lambda}}
    \eulerFunction[q_{\delta,m,\lambda}]{}^{-1}
  \right)^{r_{\delta,g}}
  \end{split}
  \label{eq:g_rtilde-m-lambda(gamma*tau)}
\end{align}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Note that formula \eqref{eq:g_rtilde-m-lambda(gamma*tau)} corresponds
to the proper generalized eta-quotient part of (2.25) in
\cite{ChenDuZhao_FindingModularFunctionsRamanujan_2019}.

If $\left\{\frac{a'g}{\delta}\right\} = \frac{\alpha}{\beta} \ne 0$,
the Jacobi function can be expanded into
\begin{align}
  \jacobiAlpha{\frac{a' g}{\delta}}{\frac{b' g}{\delta}}{q_{\delta,m,\lambda}}
  &=
  \jacobiFunction{
      \zeta_\delta^{b' g} q_{\delta,m,\lambda}^{\left\{\frac{a' g}{\delta}\right\}}
      }{q_{\delta,m,\lambda}}
  =
    \jacobiFunction{\zeta_\delta^{b' g} x^{\alpha}}{x^{\beta}}
    \label{eq:minimalRootOfUnity-g_rtilde-m-lambda}
\end{align}
where
$x = q_{\delta,m,\lambda}^{1/\beta} =
\unityPower{\frac{v_{\delta,m,\lambda}}{\beta}} q^{u_{\delta,m,\lambda}/\beta}$.




The parts of \eqref{eq:g_rtilde-m-lambda(gamma*tau)} are
implemented via
\textcolor{blue}{\code{SymbolicProperGeneralizedEtaQuotientLambdaGamma}}
(Section~\ref{sec:SymbolicEtaQuotientLambdaGamma}).
%
If \code{e = properGeneralizedEtaQuotient(rspec,m,lambda,gamma)}, then
we have the following correspondence.
\begin{align*}
  \text{\code{unityExponent(e) : Q}}
  &=
    \gensum[M]
    r_{\delta,g}
    \left(
    \kappa_{g,0,\delta,\gamma_{\delta,m,\lambda}}^{[S]}
    +
    \frac{v_{\delta,m,\lambda}}{2} P_2\left(\frac{a' g}{\delta}\right)
    \right)
  \\
  \text{\code{qExponenbt(e) : Q}}
  &=
    \gensum[M]
    \frac{r_{\delta,g} u_{\delta,m,\lambda}}{2} P_2\left(\frac{a' g}{\delta}\right)
\end{align*}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Transformations of $\sum_{n=0}^\infty \bar{a}(mn+t) q^n$}
\label{sec:p_rbar-m-t}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

In the following let $m$, $M$, $N$ be such that the conditions 1-10 of
Section~10 in
\cite{ChenDuZhao_FindingModularFunctionsRamanujan_2019} are
fulfilled.
Furthermore let $\bar{r}\in\bar{R}(M)$.
%
We follow the derivation from Section~\ref{sec:p_r-m-t} and
define
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{align*}
  \bar{f}(\tau)
  &=
  \sum_{n=0}^\infty \bar{a}(n) q^n
    =
    \unityPowerTau{-\frac{\sigmainfty[M]{\bar{r}}}{24}} g_{\bar{r}}(\tau),
  \\
  %
  \bar{f}_t(\tau)
  &=
    \unityPowerTau{- t} \bar{f}(\tau)
    =
    \unityPowerTau{-\frac{24t + \sigmainfty[M]{\bar{r}}}{24}} g_{\bar{r}}(\tau).
\end{align*}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Recall that from \eqref{eq:U_m-f_t} that
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{align}
  (U_m\bar{f}_t)(\tau)
  &=
  \frac{1}{m} \sum_{\lambda=0}^{m-1}\bar{f}_t\left(\frac{\tau+\lambda}{m}\right)
  =
    \sum_{n=0}^\infty \bar{a}(mn+t) q^n.
  \label{eq:U_m-fbar_t}
\end{align}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

We can also evaluate $(U_m\bar{f}_t)(\tau)$ in another way.
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{align*}
  (U_m\bar{f}_t)(\tau)
  &=
  \frac{1}{m} \sum_{\lambda=0}^{m-1}\bar{f}_t\left(\frac{\tau+\lambda}{m}\right)
%  \\
%  &
    =
    \frac{1}{m} \sum_{\lambda=0}^{m-1}
    \unityPower{-\frac{(\tau+\lambda) (24 t + \sigmainftybar[M]{\bar{r}})}{24 m}}
    g_{\bar{r}}\!\left(\frac{\tau+\lambda}{m}\right)
  \\
% &=
% \frac{1}{m} \sum_{\lambda=0}^{m-1}
% \unityPower{-\frac{t\tau+t\lambda}{m} - \frac{\tau+\lambda}{24m} \sigmainfty{r}}
% g_r\left(\frac{\tau+\lambda}{m}\right)\\
  &=
  \frac{1}{m}
  \unityPowerTau{-\frac{24t+\sigmainftybar[M]{\bar{r}}}{24m}}
  \sum_{\lambda=0}^{m-1}
  \unityPower{-\frac{\lambda (24t+\sigmainftybar[M]{\bar{r}})}{24m}}
  g_{\bar{r},m,\lambda}(\tau)
\end{align*}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


In the following we consider the function
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{align}
  \defineNotation[p-rbar-m-t-tau]{p_{\bar{r},m,t}(\tau)}
  &:= \unityPowerTau{\frac{24t+\sigmainfty[M]{\bar{r}}}{24m} } (U_mf_t)(\tau)
  =
    \frac{1}{m} \sum_{\lambda=0}^{m-1}
    \unityPower{-\frac{\lambda}{24m} (24t+\sigmainftybar[M]{\bar{r}})}
    g_{\bar{r},m,\lambda}(\tau)
  \label{eq:p_rbar-m-t(tau)}
\end{align}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
and its transformations under $\SL2Z$.

Note that $g_{\bar{r}} = g_{\bar{r},1,0}=p_{\bar{r},1,0}$.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Transformation of $p_{\bar{r},m,t}$ under $\SL2Z$}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

From its definition~\eqref{eq:p_rbar-m-t(tau)} and
\eqref{eq:g_r-m-lambda(gamma*tau)},
\eqref{eq:g_rtilde-m-lambda(gamma*tau)}, we can easily find a formula
for the transformation of $p_{\bar{r},m,t}$ under $\SL2Z$.

\begin{align}
  \defineNotation[p-rbar-m-t-gamma-tau]{p_{\bar{r},m,t}(\gamma\tau)}
  &:=\frac{1}{m} \sum_{\lambda=0}^{m-1}
    \unityPower{-\frac{\lambda}{24m}\Bigl(24t+\sigmainftybar[M]{\bar{r}}\Bigr)}
    g_{\bar{r},m,\lambda}(\gamma\tau)
  \notag\\
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  \begin{split}
  &=
    \frac{(c\tau+d)^{\divisorsum{M} \frac{r_\delta}{2}}}{m}
    \sum_{\lambda=0}^{m-1}
    \unityPower{-\frac{\lambda}{24m}\Bigl(24t+\sigmainftybar[M]{\bar{r}}\Bigr)}
    \cdot
    \unityPower{\divisorsum{M}\frac{r_\delta(v_{\delta,m\lambda}
                + \kappa_{\gamma_{\delta,m,\lambda}})}{24}}
  \times\\
  & \qquad\times
    \divisorprod{M}
    \left(\frac{h_{\delta,m,\lambda}}{\delta}\right)^{\!\frac{r_\delta}{2}}
    \cdot
    \unityPowerTau{\frac{\divisorsum{M} r_\delta u_{\delta,m,\lambda}}{24}}
    \cdot
    \divisorprod{M}
    \eulerFunction[q_{\delta,m,\lambda}]{}^{r_\delta}
  \times\\
  & \qquad\times
    \unityPower{
      \gensum[M]
      r_{\delta,g}
      \left(
      \kappa_{g,0,\delta,\gamma_{\delta,m,\lambda}}^{[S]}
      +
      \frac{v_{\delta,m,\lambda}}{2} P_2\left(\frac{a' g}{\delta}\right)
      \right)}
  \cdot
  \unityPowerTau{
    \gensum[M]
    \frac{r_{\delta,g} u_{\delta,m,\lambda}}{2} P_2\left(\frac{a' g}{\delta}\right)}
  \times
  \\
  &\qquad\qquad
  \times
  \genprod[M]
  \left(
    \jacobiAlpha{\frac{a' g}{\delta}}{\frac{b' g}{\delta}}{q_{\delta,m,\lambda}}
    \eulerFunction[q_{\delta,m,\lambda}]{}^{-1}
  \right)^{r_{\delta,g}}
  \end{split}
  \notag\\
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  \begin{split}
  &=
    \frac{(c\tau+d)^{\divisorsum{M} \frac{r_\delta}{2}}}{m}
  \times\\
  & \qquad\times
  \sum_{\lambda=0}^{m-1}
    \unityPower{-\frac{\lambda}{24m}\Bigl(24t+\sigmainftybar[M]{\bar{r}}\Bigr)
      + \divisorsum{M}\frac{r_\delta(v_{\delta,m\lambda}
        + \kappa_{\gamma_{\delta,m,\lambda}})}{24}
      +
      \gensum[M]
      r_{\delta,g}
      \left(
        \kappa_{g,0,\delta,\gamma_{\delta,m,\lambda}}^{[S]}
        +
        \frac{v_{\delta,m,\lambda}}{2} P_2\left(\frac{a' g}{\delta}\right)
      \right)}
  \times\\
  & \qquad\qquad\times
    \divisorprod{M}
    \left(\frac{h_{\delta,m,\lambda}}{\delta}\right)^{\!\frac{r_\delta}{2}}
    \cdot
    \unityPowerTau{
    \frac{\divisorsum{M} r_\delta
        u_{\delta,m,\lambda}}{24}
      +
    \gensum[M]
    \frac{r_{\delta,g} u_{\delta,m,\lambda}}{2} P_2\left(\frac{a'
        g}{\delta}\right)
    }
  \times
  \\
  &\qquad\qquad
  \times
  \divisorprod{M}
  \eulerFunction[q_{\delta,m,\lambda}]{}^{r_\delta}
  \cdot
  \genprod[M]
  \left(
    \jacobiAlpha{\frac{a' g}{\delta}}{\frac{b' g}{\delta}}{q_{\delta,m,\lambda}}
    \eulerFunction[q_{\delta,m,\lambda}]{}^{-1}
  \right)^{r_{\delta,g}}
  \end{split}
  \notag\\
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  \begin{split}
  &=
    \frac{(c\tau+d)^{\divisorsum{M} \frac{r_\delta}{2}}}{m}
  \times\\
  & \qquad\times
  \sum_{\lambda=0}^{m-1}
    \unityPower{-\frac{\lambda}{24m}\Bigl(24t+\sigmainftybar[M]{\bar{r}}\Bigr)
      + \divisorsum{M}\frac{r_\delta(v_{\delta,m\lambda}
        + \kappa_{\gamma_{\delta,m,\lambda}})}{24}
      +
      \gensum[M]
      r_{\delta,g}
      \left(
        \kappa_{g,0,\delta,\gamma_{\delta,m,\lambda}}^{[S]}
        +
        \frac{v_{\delta,m,\lambda}}{2} P_2\left(\frac{a' g}{\delta}\right)
      \right)}
  \times\\
  & \qquad\qquad\times
    \divisorprod{M}
    \left(\frac{h_{\delta,m,\lambda}}{\delta}\right)^{\!\frac{r_\delta}{2}}
    \cdot
    \unityPowerTau{
    \frac{\divisorsum{M} r_\delta
        u_{\delta,m,\lambda}}{24}
      +
    \gensum[M]
    \frac{r_{\delta,g} u_{\delta,m,\lambda}}{2} P_2\left(\frac{a'
        g}{\delta}\right)
    }
  \times
  \\
  &\qquad\qquad
  \times
  \divisorprod{M}
  \eulerFunction[q_{\delta,m,\lambda}]{}^{r_\delta - \tilde{r}_\delta}
  \cdot
  \genprod[M]
  \jacobiAlpha{\frac{a' g}{\delta}}
              {\frac{b' g}{\delta}}
              {q_{\delta,m,\lambda}}^{r_{\delta,g}}
  \end{split}
  \label{eq:p_rbar-m-t(gamma*tau)}
\end{align}
where
$\tilde{r}_\delta := \sum_{0 < g < \frac{\delta}{2}} r_{\delta,g}$.


The parts of \eqref{eq:p_rbar-m-t(gamma*tau)} are implemented via
\textcolor{blue}{\code{SymbolicGeneralizedEtaQuotientGamma}}
(Section~\ref{sec:SymbolicGeneralizedEtaQuotientGamma}).
\\
If \code{e = generalizedEtaQuotient(mm, rbar, m, t, gamma)}, then we have the
following correspondence.
\begin{align*}
  \text{\code{unityExponent(e) : Q}}
  &=
    -\frac{24t+\sigmainftybar[M]{\bar{r}}}{24m}
\end{align*}
















From \eqref{eq:g_r(tau)}, \eqref{eq:eta_delta-g^[R](tau)},
\eqref{eq:g_rbar(tau)}, \eqref{eq:U_m-fbar_t} and
\eqref{eq:p_rbar-m-t(tau)}, we can define
\begin{align}
  \defineNotation[F-sbar-rbar-m-t]{F_{\bar{s}, \bar{r}, m, t}(\tau)}
  &:= \divisorprod{N} \eta(\delta\tau)^{s_{\delta}}
    \genprod[N] \eta_{\delta,g}(\tau)^{s_{\delta,g}}
    \cdot p_{\bar{r},m,t}(\tau)
  \notag\\
  &=
    q^{\bar{\alpha}}
    \cdot
    \divisorprod{M}
    \eulerFunction{\delta}^{s_\delta}
    \cdot
    \genprod[M]
    \left(
    \qPochhammer{q^g}{q^\delta} \qPochhammer{q^g}{q^\delta}
    \right)^{s_{\delta,g}}
    \sum_{n=0}^\infty \bar{a}(mn+t) q^n
    \label{eq:F_sbar-rbar-m-t(tau)}
\end{align}
where
\begin{align}
  \bar{\alpha}
  &=
    \frac{\sigmazerobar[N]{\bar{s}}}{24}
    +
    \frac{24t+\sigmainftybar[M]{\bar{r}}}{24m}
    \label{eq:alphabarInfinity}
\end{align}
is defined as a generalization of \eqref{eq:alphaInfinity}.

Similar to Theorem~\ref{thm:RaduConditions} we have the following
theorem.


\subsubsection{Find ``$\Gamma_1(N)$-modular'' cofactor with only pole
  at $\infty$}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Suppose $\bar{s}$ is a solution (a column vector with \code{#idxs}
components) of the system from
Theorem~\ref{thm:condition-co-eta-quotient-gamma1} for given $\bar{r}$
and $\bar{b_i}$, $i=1,\ldots,k$ form a basis of solutions for the
corresponding homogeneous system. Note that the $\bar{b}_i$ describe
$\Gamma_1(N)$-modular generalized eta-quotients (with possible poles
at any cusp).

Furthermore assume that $A$ is the matrix that determines the order of
the expansion of generalized eta-quotients corresponding to an
exponent vector (like $\bar{b}_i$). $A$ can be computed by
\code{matrixEtaOrder(nn,spitzen,idxs)}. The matrix $A$ is indexed by
the cusps in \code{spitzen} (rows) and the indices $(\delta,g)$ from
\code{idxs} (columns).

Then $A \bar{b}_i$ is a column vector that gives the order of the
$q$-expansion (corresponding to $\bar{b}_i$) at each cusp that is in
\code{spitzen}.

Let $v$ be the column vector of the orders (at all cusps) of
$F_{\bar{s},\bar{r},m,t}(\tau)$.

By adding a $\setZ$-linear
combination of the $\bar{b}_i$ to $\bar{s}$ we find
$c_1,\ldots,c_k$ such that
\begin{gather}
  v' + A'(c_1\bar{b}_1+\dots+c_k\bar{b}_k)
  =
  v' + A'(\bar{b}_1,\ldots,\bar{b}_k) c
  =
  v' + G' c
  \ge 0
\end{gather}
where the prime means removing the component for the cusp $\infty$
and $o_i':= A' \bar{b}_i$, $O':=(o_1',\ldots,o_k')$,
$c = (c_1,\ldots, c_k)^T$.

Thus we must solve the following system
\begin{gather}
  \label{eq:remove-non-infinity-poles}
  O' c \ge -v'
\end{gather}
in order to find $c_1,\ldots, c_k$.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\iffalse
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% The following was the text when we worked with grades (=poleorders)
% instead of orders.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
By subtracting a $\setZ$-linear
combination of the $\bar{b}_i$ from $\bar{s}$ we find
$c_1,\ldots,c_k$ such that
\begin{gather}
  v' - A'(c_1\bar{b}_1+\dots+c_k\bar{b}_k)
  =
  v' - A'(\bar{b}_1,\ldots,\bar{b}_k) c
  =
  - u' + G' c
  \ge 0
\end{gather}
where the prime means removing the component for the cusp $\infty$
and $u':=-v'$, $g_i':= - A' \bar{b}_i$, $G':=(g_1',\ldots,g_k')$,
$c = (c_1,\ldots, c_k)^T$.

In the implementation we work with grades (which is the negation of
the expansion order and corresponds to the pole order of the
expansion). Thus we must solve the following system
\begin{gather}
  \label{eq:remove-non-infinity-poles}
  G' c \ge u'
\end{gather}
in order to find $c_1,\ldots, c_k$.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\fi
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%








%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Implementation}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{YEG SymbolicEtaGamma}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

SymbolicEtaGamma collects data for the expansion of
$\eta_{\delta,m,\lambda}(\gamma\tau)$ and
$\eta_{\delta,g,m,\lambda}^{[R]}(\gamma\tau)$. See
\eqref{eq:eta_delta-m-lambda(gamma*tau)} and
\eqref{eq:eta_delta-g-m-lambda^[R](gamma*tau)}.



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{YEQLG SymbolicEtaQuotientLambdaGamma}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

SymbolicEtaQuotientLambdaGamma holds data to compute an eta quotient
expansion of $g_{r,m,\lambda}(\gamma \tau)$. See
\eqref{eq:g_r-m-lambda(gamma*tau)}.



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{YEQG SymbolicEtaQuotientGamma}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

SymbolicEtaQuotientGamma holds data to compute an eta quotient
expansion of $p_{r,m,t}(\gamma \tau)$. See
\eqref{eq:p_r-m-t(gamma*tau)} and \eqref{eq:p_rbar-m-t(gamma*tau)}.



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\end{document}
