-- -*- coding: utf-8 -*-
-- Via jupytext this file can be shown as a jupyter notebook.

)clear complete

)read /home/hemmecke/g/qeta/input/jfricas-test-support.input

-- # Problem formulation


-- This worksheet contains some formulas and computations from
-- the following article.
--
--     @article{Yang:DefiningEquationsOfModularCurves:2006,
--       author =       {Yifan Yang},
--       title =        {Defining equations of modular curves},
--       journal =      {Advances in Mathematics},
--       volume =       204,
--       number =       2,
--       pages =        {481-508},
--       year =         2006,
--       issn =         {0001-8708},
--       doi =          {10.1016/j.aim.2005.05.019},
--       url =
--                       {https://www.sciencedirect.com/science/article/pii/S0001870805001714},
--       keywords =     {Modular curves, Generalized Dedekind eta-functions,
--                       Cusp forms, Modular parameterization of rational
--                       elliptic curves},
--       abstract =     {We obtain defining equations of modular curves
--                       X0(N), X1(N), and X(N) by explicitly constructing
--                       modular functions using generalized Dedekind eta
--                       functions. As applications, we describe a method of
--                       obtaining a basis for the space of cusp forms of
--                       weight 2 on a congruence subgroup. We also use our
--                       model of X0(37) to find explicit modular
--                       parameterization of rational elliptic curves of
--                       conductor 37.}
--     }
--
-- Below we check the entries of page 506 of the above article.
-- We have found errors for the entries of level 13 and level 22.

-- # Init

-- +
-------------------------------------------------------------------
--setup
-------------------------------------------------------------------

-- +
)set mess type off
)set mess time off
)read convenience.input )quiet
-- We correct a macro since oldEXPANDn does not work for YM1GEQ.
expandAnCX y ==> (laurentExpansions(y)$QESX(C,CX))::An(CX)

C ==> Q
LZ ==> List Z
LLZ ==> List LZ

oo ==> infinity()$Cusp

CurveX1(nn: P, rx: LLZ, sx: C,_
               ry: LLZ, sy: C,_
               x: Symbol, y: Symbol,_
        pxy: Polynomial(C)): Boolean ==
    rspecx := geqSPEC(nn, [cons(nn,r) for r in rx]);
    rspecy := geqSPEC(nn, [cons(nn,r) for r in ry]);
    yx := specYM1GEQ(rspecx); xiordx := minimalRootOfUnity(yx)::P;
    yy := specYM1GEQ(rspecy); xiordy := minimalRootOfUnity(yy)::P;
    xiord := lcm(xiordx,xiordy);
    EXTENDEDCOEFFICIENTRING(C, xiord, CX, xi);
    spitzen := cusps(nn)$GAMMA1;
    e := 1$An(CX);
    ax := expandAnCX(yx) + sx*e;
    ay := expandAnCX(yy) + sy*e;
    qetaGrades ax;
    qetaGrades ay;
    n := position(oo,spitzen)
    xx := toX1(C, series(ax,n), x); gx := qetaGrade xx;
    xy := toX1(C, series(ay,n), y); gy := qetaGrade xy;
    xab := samba(xx, [xy])$QXTOPSAMBA1(C)
    red := reduce(xy^gx, xab)$QXTOPRED1(C)
    tracePrint("red", red)
    polc := second(red)::Pol(C)
    d := degree(polc, y)
    polc := (inv(coefficient(polc, y, d)) * polc)
    assertEquals(polc, pxy)
    pol := polc::Pol(Z)
    for i in 0..d repeat tracePrint("c", factor coefficient(pol,'y, i))
    LC ==> leadingCoefficient;
    mons := monomials pxy;
    z := [(d := degree(m,[x,y]); LC(m)*ax^(d.1)*ay^(d.2)) for m in mons];
    b: Boolean := zero? reduce(_+, z)
    assertTrue(b)
    b

CX1(nn,rx,sx,ry,sy,pxy) ==> CurveX1(nn,rx,sx,ry,sy,x,y,pxy)
)set stream calc 1

-- +
--)set mess type on
--)set mess time on

-- +
-------------------------------------------------------------------
--endsetup
-------------------------------------------------------------------

-- # $X_1(11)$

-- +
-------------------------------------------------------------------
--test:xy11
-------------------------------------------------------------------
-- -

CX1(11,_
  [[1,-2],[2,-1],[3,1],[4,1],[5,1]],_
  0,_
  [[1,-3],[2,-1],[4,3],[5,1]],_
  -1,_
  y^2 + y - x^3 + x^2)


-- +
-------------------------------------------------------------------
--endtest
-------------------------------------------------------------------

-- # $X_1(13)$

-- +
-------------------------------------------------------------------
--test:xy13
-------------------------------------------------------------------
-- -

-- Typo in the \cite[p.~506]{Yang:DefiningEquationsOfModularCurves:2006}.
-- There is a shift of -1 missing for x.


CX1(13,_
  [[1,-2],[2,-1],[3,-1],[4,2],[5,1],[6,1]],_
  -1,_
  [[1,-3],[2,-1],[4,1],[6,3]],_
  0,_
  y^3 - (x-1)*y^2 - x*y - x^4 - x^3)


-- +
-------------------------------------------------------------------
--endtest
-------------------------------------------------------------------

-- # $X_1(14)$

-- +
-------------------------------------------------------------------
--test:xy14
-------------------------------------------------------------------
-- -

CX1(14,_
  [[1,-1],[2,-2],[3,1],[4,2],[5,-1],[7,1]],_
  -1,_
  [[1,-1],[2,-2],[3,-1],[4,1],[5,2],[6,1]],_
  -1,_
  y^2 + x*y + y - x^3 + x)


-- +
-------------------------------------------------------------------
--endtest
-------------------------------------------------------------------

-- # $X_1(15)$

-- +
-------------------------------------------------------------------
--test:xy15
-------------------------------------------------------------------
-- -

CX1(15,_
  [[1,-1],[2,-1],[4,1],[7,1]],_
  -1,_
  [[1,-1],[2,-1],[3,-2],[4,1],[5,1],[6,2]],_
  -1,_
  y^2 + x*y + y - x^3 - x^2)


-- +
-------------------------------------------------------------------
--endtest
-------------------------------------------------------------------

-- # $X_1(16)$

-- +
-------------------------------------------------------------------
--test:xy16
-------------------------------------------------------------------
-- -

CX1(16,_
  [[1,-1],[2,-1],[3,-1],[5,1],[6,1],[7,1]],_
  0,_
  [[1,-1],[2,-2],[3,-1],[4,1],[7,2],[8,1]],_
  1,_
  y^3 + (x-1)*y^2 -x^2*y - x^4 + x^3)


-- +
-------------------------------------------------------------------
--endtest
-------------------------------------------------------------------

-- # $X_1(17)$

-- +
-------------------------------------------------------------------
--test:xy17
-------------------------------------------------------------------
-- -

CX1(17,_
  [[1,-2],[2,-1],[3,-1],[6,2],[7,1],[8,1]],_
  0,_
  [[1,-3],[2,-2],[6,2],[7,1],[8,2]],_
  0,_
  y^5 _
     -(4*x-1) * y^4 _
     + (6*x^2 - 3*x) * y^3 _
     - (x^4 + 4*x^3 - 5*x^2 + x) * y^2 _
     + x^3*(4*x-1)*(x-1) * y _
     - x^6*(x-1))


-- +
-------------------------------------------------------------------
--endtest
-------------------------------------------------------------------

-- # $X_1(18)$

-- +
-------------------------------------------------------------------
--test:xy18
-------------------------------------------------------------------
-- -

CX1(18,_
  [[1,-1],[2,-1],[3,-1],[4,1],[5,1],[9,1]],_
  0,_
  [[1,-1],[2,-1],[3,-1],[4,-1],[5,1],[6,1],[7,1],[8,1]],_
  -1,_
  y^3 + x*y^2 + (2*x^2-2*x)*y - x^4 + 3*x^3 - 2*x^2)


-- +
-------------------------------------------------------------------
--endtest
-------------------------------------------------------------------

-- # $X_1(19)$

-- +
-------------------------------------------------------------------
--test:xy19
-------------------------------------------------------------------
-- -

CX1(19,_
  [[1,-2],[2,-1],[3,-1],[6,1],[8,1],[9,2]],_
  1,_
  [[1,-3],[2,-3],[3,-2],[4,1],[5,-1],[6,2],[7,2],[8,2],[9,2]],_
  0,_
  y^6 - (5*x-3) * y^5
  - (3*x^3-15*x^2+14*x-3) * y^4_
  + (x-1)*(9*x^4-18*x^3+7*x^2-1) * y^3_
  - x^2*(x-1)*(9*x^4-20*x^3+13*x^2-x-2) * y^2_
  + x^4*(x-1)^2*(4*x^3-6*x^2+2*x+1) * y_
  - x^7*(x-1)^4)


-- +
-------------------------------------------------------------------
--endtest
-------------------------------------------------------------------

-- # $X_1(20)$

-- +
-------------------------------------------------------------------
--test:xy20
-------------------------------------------------------------------
-- -

CX1(20,_
  [[1,-1],[2,-1],[4,-1],[6,1],[8,1],[9,1]],_
  0,_
  [[1,-1],[2,-1],[3,-1],[4,-1],[5,1],[8,1],[9,1],[10,1]],_
  1,_
  y^4 + x*y^3 + (2*x-3)*x*y^2 - x*(2*x^2-1)*y - x^4*(x-1))


-- +
-------------------------------------------------------------------
--endtest
-------------------------------------------------------------------

-- # $X_1(21)$

-- +
-------------------------------------------------------------------
--test:xy21
-------------------------------------------------------------------
-- -

CX1(21,_
  [[1,-1],[2,-1],[3,-1],[5,-1],[6,1],[7,1],[8,1],[10,1]],_
  0,_
  [[1,-2],[2,-2],[4,1],[5,-1],[7,1],[8,1],[10,2]],_
  0,_
  y^5 - (6*x-4)*y^4 + (2*x-1)*(7*x-6) * y^3_
      - 3*(x-1)*(x^3+3*x^2-4*x+1) * y^2_
      + 3*x^2*(x-1)^2*(2*x-1) * y_
      - x^4*(x-1)^3)


-- +
-------------------------------------------------------------------
--endtest
-------------------------------------------------------------------

-- # $X_1(22)$

-- +
-------------------------------------------------------------------
--test:xy22
-------------------------------------------------------------------
-- -

-- Typo in the \cite[p.~506]{Yang:DefiningEquationsOfModularCurves:2006}.
-- There is a shift of -1 missing for x and for y.


CX1(22,_
  [[1,-1],[2,-1],[3,-1],[4,-1],[7,1],[8,1],[9,1],[10,1]],_
  -1,_
  [[1,-1],[2,-2],[3,-1],[8,1],[9,2],[10,1]],_
  -1,_
  y^6 + (x+5) * y^5 - (4*x^2+2*x-8) * y^4_
      - (2*x^3+16*x^2+14*x-4) * y^3_
      + x*(6*x^3+11*x^2-6*x-12) * y^2_
      + 2*x^2*(x+1)*(x^2+6*x+6) * y_
      - x^3*(x+1)^2*(x+2)^2)


-- +
-------------------------------------------------------------------
--endtest
-------------------------------------------------------------------
